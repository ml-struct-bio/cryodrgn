<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cryoDRGN EMPIAR-10076 tutorial &mdash; CryoDRGN  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="cryoDRGN Conformational Landscape Analysis" href="landscape_analysis.html" />
    <link rel="prev" title="cryoDRGN Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CryoDRGN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">‚ùÑÔ∏èüêâ cryoDRGN Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">cryoDRGN Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">cryoDRGN EMPIAR-10076 tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#obtain-the-dataset">1) Obtain the dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consensus-reconstruction-optional">2) Consensus reconstruction (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preprocess-inputs">3) Preprocess inputs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#convert-poses-to-cryodrgn-format">3.1) Convert poses to cryoDRGN format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#convert-ctf-parameters-to-cryodrgn-format">3.2) Convert CTF parameters to cryoDRGN format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#downsample-images">3.3) Downsample images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cryodrgn-training">4) CryoDRGN training</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-recommended-workflow">General recommended workflow**</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cryodrgn-initial-training">CryoDRGN initial training</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extending-or-restarting-from-a-checkpoint">Extending or restarting from a checkpoint</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cryodrgn-analysis">5) cryoDRGN analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-s-in-the-analysis-directory"><strong>What‚Äôs in the analysis directory?</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualization-of-the-latent-space">Visualization of the latent space</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sampled-density-maps">Sampled density maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pc-trajectories">PC trajectories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#particle-filtering-with-the-cryodrgn-jupyter-notebook">6) Particle filtering with the cryoDRGN Jupyter notebook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-jupyter-notebook">6.1) Accessing the jupyter notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-jupyter-notebook-for-particle-filtering">6.2) Run the jupyter-notebook for particle filtering</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#published-filtering-results"><strong>Published filtering results</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#filtering-by-gmm-cluster-label">6.3) <strong>Filtering by GMM cluster label</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#alternative-method-filtering-by-z-score">Alternative method: <strong>Filtering by z-score</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#alternative-method-filtering-with-an-interactive-lasso-tool">Alternative method: <strong>Filtering with an interactive lasso tool</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#view-the-raw-particles">View the raw particles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#saving-the-selection">Saving the selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-functionality-writing-a-new-star-file">(Additional Functionality) Writing a new .star file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-functionality-extracting-a-new-particle-stack">(Additional Functionality) Extracting a new particle stack</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cryodrgn-high-resolution-training">7) CryoDRGN high-resolution training</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accelerated-training-with-gpu-parallelization"><strong>Accelerated training with GPU parallelization</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#accelerated-training-with-mixed-precision-mode">Accelerated training with mixed-precision mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analysis">8) Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cryodrgn-analyze">8.1) cryodrgn analyze</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Visualization of the latent space</a></li>
<li class="toctree-l4"><a class="reference internal" href="#default-sampled-density-maps">Default sampled density maps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">PC trajectories</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-cryodrgn-jupyter-notebook">8.2) The cryoDRGN jupyter notebook</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#starting-the-jupyter-notebook">Starting the jupyter notebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-jupyter-notebook">Running the jupyter notebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparing-to-3d-classification-labels">Comparing to 3D classification labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generating-additional-volumes">Generating additional volumes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extracting-particles-for-traditional-refinement">8.3) Extracting particles for traditional refinement</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#interactive-selection">Interactive selection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#converting-to-a-star-file">Converting to a .star file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#re-extracting-particles-from-the-micrograph">Re-extracting particles from the micrograph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-trajectories">8.4) Generating trajectories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cryodrgn-graph-traversal">cryodrgn graph_traversal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generating-assembly-trajectories">Generating assembly trajectories</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="landscape_analysis.html">cryoDRGN Conformational Landscape Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="large_datasets.html">cryoDRGN preprocess for large datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="cryodrgn2.html">CryoDRGN2 quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ / Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CryoDRGN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">cryoDRGN EMPIAR-10076 tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/empiar_tutorial.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cryodrgn-empiar-10076-tutorial">
<h1>cryoDRGN EMPIAR-10076 tutorial<a class="headerlink" href="#cryodrgn-empiar-10076-tutorial" title="Link to this heading">ÔÉÅ</a></h1>
<p>This walkthrough of cryoDRGN analysis of the <strong>assembling ribosome dataset (EMPIAR-10076)</strong> from Figure 5 of <a class="reference external" href="https://www.nature.com/articles/s41592-020-01049-4">Zhong et al.</a> covers:</p>
<ol class="arabic simple">
<li><p>preprocessing of inputs,</p></li>
<li><p>initial cryoDRGN training and analysis,</p></li>
<li><p>removing junk particles,</p></li>
<li><p>high-resolution cryoDRGN training and analysis,</p></li>
<li><p>extracting particles for traditional refinement, and</p></li>
<li><p>generation of trajectories.</p></li>
</ol>
<p><img alt="Figure 5 from Zhong et al 2021." src="../_images/Untitled.png" />
<em>Figure 5 from Zhong et al 2021.</em></p>
<iframe src="https://widgets.figshare.com/articles/21170908/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<ul class="simple">
<li><p>For an abbreviated overview of the steps for running cryoDRGN, see the README on the github page: <a class="reference external" href="https://github.com/zhonge/cryodrgn">https://github.com/zhonge/cryodrgn</a></p></li>
<li><p>All pre-processed inputs that are generated in this tutorial (except particle images) are also located here:  <a class="reference external" href="https://github.com/zhonge/cryodrgn_empiar">https://github.com/zhonge/cryodrgn_empiar</a></p></li>
<li><p>The final trained networks and density maps are deposited here: <a class="reference external" href="https://zenodo.org/record/4355284#.YCq_dI9Kj0o">https://zenodo.org/record/4355284</a>.</p></li>
<li><p>For compute requirements and installation instructions, see <a class="reference internal" href="installation.html"><span class="std std-doc">cryoDRGN installation with anaconda</span></a>.</p></li>
</ul>
<hr class="docutils" />
<section id="obtain-the-dataset">
<h2>1) Obtain the dataset<a class="headerlink" href="#obtain-the-dataset" title="Link to this heading">ÔÉÅ</a></h2>
<ul>
<li><p>Download EMPIAR-10076 (~51GB) from <a class="reference external" href="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10076/">https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10076/</a></p>
<ul class="simple">
<li><p>You can download it directly from the browser, or from the command line using Aspera Connect (<a class="reference external" href="https://www.ebi.ac.uk/pdbe/emdb/empiar/faq#question_CLDownload">More info here</a>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ascp</span> <span class="pre">-QT</span> <span class="pre">-l</span> <span class="pre">200M</span> <span class="pre">-P33001</span> <span class="pre">-i</span> <span class="pre">~/.aspera/connect/etc/asperaweb_id_dsa.openssh</span> <span class="pre">[emp_ext3&#64;hx-fasp-1.ebi.ac.uk](mailto:emp_ext3&#64;hx-fasp-1.ebi.ac.uk):/10076</span> <span class="pre">.</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>This dataset contains 131,899 extracted particles with box size of 320 and pixel size of 1.31 A/pix.</p>
<p><img alt="Screenshot from the EMPIAR entry" src="../_images/Untitled_1.png" />
<em>Screenshot from the EMPIAR entry</em></p>
</li>
<li><p>The <strong>particle images</strong> are in the file <code class="docutils literal notranslate"><span class="pre">L17Combine_weight_local.mrc</span></code>. There is a typo in the file extension, so rename this file with the <code class="docutils literal notranslate"><span class="pre">.mrcs</span></code> extension.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">mv</span> <span class="pre">L17Combine_weight_local.mrc</span> <span class="pre">L17Combine_weight_local.mrcs</span></code></p></li>
</ul>
</li>
<li><p>The <strong>CTF parameters</strong> for each particle are in the metadata file, <code class="docutils literal notranslate"><span class="pre">Parameters.star</span></code>. We will extract the CTF parameters from this file later in <a class="reference internal" href="#step3"><span class="std std-ref">Step 3</span></a>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">head</span> <span class="pre">Parameters.star</span> <span class="pre">-n</span> <span class="pre">20</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_</span>

<span class="n">loop_</span>
<span class="n">_rlnImageName</span> <span class="c1">#1</span>
<span class="n">_rlnMicrographName</span> <span class="c1">#2</span>
<span class="n">_rlnDefocusU</span> <span class="c1">#3</span>
<span class="n">_rlnDefocusV</span> <span class="c1">#4</span>
<span class="n">_rlnDefocusAngle</span> <span class="c1">#5</span>
<span class="n">_rlnVoltage</span> <span class="c1">#6</span>
<span class="n">_rlnSphericalAberration</span> <span class="c1">#7</span>
<span class="n">_rlnAmplitudeContrast</span> <span class="c1">#8</span>
<span class="n">_rlnMagnification</span> <span class="c1">#9</span>
<span class="n">_rlnDetectorPixelSize</span> <span class="c1">#10</span>
<span class="mi">1</span><span class="nd">@L17Combine_weight_local</span><span class="o">.</span><span class="n">mrcs</span> <span class="mi">1</span> <span class="mf">15301.1</span> <span class="mf">14916.4</span> <span class="mf">5.28</span>  <span class="mi">300</span> <span class="mf">2.7</span> <span class="mf">0.07</span> <span class="mi">38168</span> <span class="mi">5</span>
<span class="mi">2</span><span class="nd">@L17Combine_weight_local</span><span class="o">.</span><span class="n">mrcs</span> <span class="mi">2</span> <span class="mf">15303.0</span> <span class="mf">14918.4</span> <span class="mf">5.28</span>  <span class="mi">300</span> <span class="mf">2.7</span> <span class="mf">0.07</span> <span class="mi">38168</span> <span class="mi">5</span>
<span class="mi">3</span><span class="nd">@L17Combine_weight_local</span><span class="o">.</span><span class="n">mrcs</span> <span class="mi">3</span> <span class="mf">15150.7</span> <span class="mf">14766.0</span> <span class="mf">5.28</span>  <span class="mi">300</span> <span class="mf">2.7</span> <span class="mf">0.07</span> <span class="mi">38168</span> <span class="mi">5</span>
<span class="mi">4</span><span class="nd">@L17Combine_weight_local</span><span class="o">.</span><span class="n">mrcs</span> <span class="mi">4</span> <span class="mf">15181.9</span> <span class="mf">14797.3</span> <span class="mf">5.28</span>  <span class="mi">300</span> <span class="mf">2.7</span> <span class="mf">0.07</span> <span class="mi">38168</span> <span class="mi">5</span>
<span class="mi">5</span><span class="nd">@L17Combine_weight_local</span><span class="o">.</span><span class="n">mrcs</span> <span class="mi">5</span> <span class="mf">15366.8</span> <span class="mf">14982.2</span> <span class="mf">5.28</span>  <span class="mi">300</span> <span class="mf">2.7</span> <span class="mf">0.07</span> <span class="mi">38168</span> <span class="mi">5</span>
<span class="mi">6</span><span class="nd">@L17Combine_weight_local</span><span class="o">.</span><span class="n">mrcs</span> <span class="mi">6</span> <span class="mf">15305.0</span> <span class="mf">14920.3</span> <span class="mf">5.28</span>  <span class="mi">300</span> <span class="mf">2.7</span> <span class="mf">0.07</span> <span class="mi">38168</span> <span class="mi">5</span>
<span class="mi">7</span><span class="nd">@L17Combine_weight_local</span><span class="o">.</span><span class="n">mrcs</span> <span class="mi">7</span> <span class="mf">15177.4</span> <span class="mf">14792.7</span> <span class="mf">5.28</span>  <span class="mi">300</span> <span class="mf">2.7</span> <span class="mf">0.07</span> <span class="mi">38168</span> <span class="mi">5</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Poses (i.e. particle alignments) are <strong>not</strong> present in the deposited data, so we will next run a consensus reconstruction.</p></li>
</ul>
<hr class="docutils" />
</section>
<section id="consensus-reconstruction-optional">
<span id="step2"></span><h2>2) Consensus reconstruction (optional)<a class="headerlink" href="#consensus-reconstruction-optional" title="Link to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p>Perform a <strong>C1 homogeneous refinement</strong> in your favorite cryo-EM software package. We will be using the poses from this ‚Äúconsensus reconstruction‚Äù.</p></li>
<li><p>To skip this step, download the poses from <a class="reference external" href="https://github.com/zhonge/cryodrgn_empiar/blob/main/empiar10076/inputs/cryosparc_P4_J33_004_particles.cs">https://github.com/zhonge/cryodrgn_empiar/blob/main/empiar10076/inputs/cryosparc_P4_J33_004_particles.cs</a></p></li>
<li><p>A detailed walkthrough of this process is out of the scope of this guide, but we will briefly summarize the steps we used in cryoSPARC v2.4.</p>
<ul>
<li><p>In cryoSPARC, 1) import the particles, 2) run an <em>ab initio</em> reconstruction job, then 3) run a homogeneous refinement job, all with default parameters.</p>
<ul>
<li><p>For step (1), note that the data-sign of EMPIAR-10076 is flipped from most cryo-EM datasets (i.e. dark-on-light particles), so you will need to toggle the data sign when importing the particles.</p></li>
</ul>
</li>
<li><p>Final result of refinement:</p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/Untitled_2.png" />
<em>Note the partial occupancy of the mature assembly state elements (e.g. the shoulders of the ribosome); Also, note that the handedness of the reconstructed density map is flipped (50% chance from <em>ab initio</em> step). We will flip the output density maps from cryoDRGN later on in this tutorial.</em></p>
<p><img alt="" src="../_images/Untitled_3.png" />
<em>High resolution features are a good sign that the poses are accurate, even if other regions are less resolved due to heterogeneity.</em></p>
<p><img alt="assets/Untitled_4.png" src="../_images/Untitled_4.png" /></p>
<p><img alt="" src="../_images/Untitled_5.png" />
<em>CryoSPARC‚Äôs metadata file (a .cs file) that contains particle poses and CTF parameters can be downloaded from the web interface as the ‚Äúalignments3D‚Äù output or found in the job directory in the filesystem where cryoSPARC is running.</em></p>
</section>
<section id="preprocess-inputs">
<span id="step3"></span><h2>3) Preprocess inputs<a class="headerlink" href="#preprocess-inputs" title="Link to this heading">ÔÉÅ</a></h2>
<p>In this step, we will first extract poses (<a class="reference internal" href="#step3-1"><span class="std std-ref">Step 3.1</span></a>), then extract CTF parameters (<a class="reference internal" href="#step3-2"><span class="std std-ref">Step 3.2</span></a>), then downsample our images (<a class="reference internal" href="#step3-3"><span class="std std-ref">Step 3.3</span></a>).</p>
<p>Pose and CTF parameters are stored in various formats depending on the upstream processing software. CryoDRGN contains scripts to convert this information to a <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> file format.</p>
<ul>
<li><p>What are <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> files?</p>
<p>A <a class="reference external" href="https://docs.python.org/3/library/pickle.html">pickle</a> is a python module/format that allows you to serialize most python data objects to disk and re-load without any type conversion or file parsing. You can view any .pkl object using the cryoDRGN API :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cryodrgn</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_pkl</span><span class="p">(</span><span class="s1">&#39;z.pkl&#39;</span><span class="p">)</span>
<span class="n">utils</span><span class="o">.</span><span class="n">save_pkl</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;z.copy.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<section id="convert-poses-to-cryodrgn-format">
<span id="step3-1"></span><h3>3.1) Convert poses to cryoDRGN format<a class="headerlink" href="#convert-poses-to-cryodrgn-format" title="Link to this heading">ÔÉÅ</a></h3>
<ul>
<li><p>CryoDRGN has two executables for parsing pose information (i.e. particle alignments) from either a cryoSPARC <code class="docutils literal notranslate"><span class="pre">.cs</span></code> file or a RELION <code class="docutils literal notranslate"><span class="pre">.star</span></code> file.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">parse_pose_star</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn parse_pose_star -h
usage: cryodrgn parse_pose_star [-h] -o PKL [-D D] [--Apix APIX] input

Parse image poses from RELION .star file

positional arguments:
  input        RELION .star file

optional arguments:
  -h, --help   show this help message and exit
  -o PKL       Output pose.pkl

Optionally provide missing image parameters:
  -D D         Box size of reconstruction (pixels)
  --Apix APIX  Pixel size (A); Required if translations are specified in Angstroms
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-D</span></code> should be set to the box size of the refinement</p></li>
<li><p>Note: the flag  <code class="docutils literal notranslate"><span class="pre">--relion31</span></code> and the argument  <code class="docutils literal notranslate"><span class="pre">--Apix</span> <span class="pre">X.XX</span></code> are required if the .star file from RELION version 3.1 or later (e.g. if the .star file contains the <code class="docutils literal notranslate"><span class="pre">data_optics</span></code> group). The pixel size should be the pixel size of the refinement.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">parse_pose_csparc</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn parse_pose_csparc -h
usage: cryodrgn parse_pose_csparc [-h] [--abinit] [--hetrefine] -D D -o PKL input

Parse image poses from a cryoSPARC .cs metafile

positional arguments:
  input        Cryosparc .cs file

optional arguments:
  -h, --help   show this help message and exit
  --abinit     Flag if results are from ab-initio reconstruction
  --hetrefine  Flag if results are from a heterogeneous refinements (default: homogeneous refinement)
  -D D         Box size of reconstruction (pixels)
  -o PKL       Output pose.pkl
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>For this tutorial, we will use <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">parse_pose_csparc</span></code>  to extract poses from the cryoSPARC refinement output <code class="docutils literal notranslate"><span class="pre">cryosparc_P4_J33_004_particles.cs</span></code> from <a class="reference internal" href="#step2"><span class="std std-ref">Step 2</span></a>.</p>
<ul>
<li><p>Example command and output:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cryodrgn</span> <span class="pre">parse_pose_csparc</span> <span class="pre">cryosparc_P4_J33_004_particles.cs</span> <span class="pre">-D</span> <span class="pre">320</span> <span class="pre">-o</span> <span class="pre">poses.pkl</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) [Wed Feb 03 17:12 het] cryodrgn parse_pose_csparc empiar10076/P4/J33/cryosparc_P4_J33_004_particles.cs -D 320 -o poses.pkl
0 uid 3300296402854382810
1 blob/path b&#39;J3/imported/L17Combine_weight_local.mrcs&#39;
2 blob/idx 0
3 blob/shape [320 320]
4 blob/psize_A 1.31
5 blob/sign 1.0
6 ctf/type b&#39;imported&#39;
7 ctf/accel_kv 300.0
8 ctf/cs_mm 2.7
9 ctf/amp_contrast 0.07
10 ctf/df1_A 15301.1
11 ctf/df2_A 14916.4
12 ctf/df_angle_rad 0.092153385
13 ctf/phase_shift_rad 0.0
14 ctf/scale 1.0
15 ctf/scale_const 0.0
16 ctf/cross_corr_ctffind4 0.0
17 ctf/ctf_fit_to_A 0.0
18 ctf/fig_of_merit_gctf 0.0
19 prepare/float_value 0.0
20 alignments3D/split 1
21 alignments3D/shift [2.75 7.85]
22 alignments3D/pose [ 2.1353014 -1.3428906 -0.8660417]
23 alignments3D/psize_A 1.31
24 alignments3D/error 25082.113
25 alignments3D/error_min 25068.746
26 alignments3D/resid_pow 25082.113
27 alignments3D/slice_pow 133.63882
28 alignments3D/image_pow 25300.285
29 alignments3D/cross_cor 351.81055
30 alignments3D/alpha 1.3162737
31 alignments3D/weight 0.0
32 alignments3D/pose_ess 0.0
33 alignments3D/shift_ess 0.0
34 alignments3D/class_posterior 1.0
35 alignments3D/class 0
36 alignments3D/class_ess 1.0
2021-02-03 17:13:12     Extracting rotations from alignments3D/pose
2021-02-03 17:13:12     Transposing rotation matrix
2021-02-03 17:13:13     (131899, 3, 3)
2021-02-03 17:13:13     Extracting translations from alignments3D/shift
2021-02-03 17:13:13     (131899, 2)
2021-02-03 17:13:13     Writing /red/zhonge/cryoem/vae3d/00_data/empiar10076/het/poses.pkl
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Note: <code class="docutils literal notranslate"><span class="pre">-D</span></code> should be set to the box size of the refinement, which was 320 in this case</p></li>
</ul>
<hr class="docutils" />
</section>
<section id="convert-ctf-parameters-to-cryodrgn-format">
<span id="step3-2"></span><h3>3.2) Convert CTF parameters to cryoDRGN format<a class="headerlink" href="#convert-ctf-parameters-to-cryodrgn-format" title="Link to this heading">ÔÉÅ</a></h3>
<ul>
<li><p>CryoDRGN has two executables for parsing CTF information from either a cryoSPARC <code class="docutils literal notranslate"><span class="pre">.cs</span></code> file or a RELION <code class="docutils literal notranslate"><span class="pre">.star</span></code> file.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">parse_ctf_star</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn parse_ctf_star -h
usage: cryodrgn parse_ctf_star [-h] -o O [--png PNG] [-D D] [--Apix APIX] [--kv KV] [--cs CS] [-w W] [--ps PS] star

Parse CTF parameters from a RELION .star file

positional arguments:
  star         Input

optional arguments:
  -h, --help   show this help message and exit
  -o O         Output pkl of CTF parameters
  --png PNG    Optionally plot the CTF

Optionally provide missing image parameters:
  -D D         Image size in pixels
  --Apix APIX  Angstroms per pixel
  --kv KV      Accelerating voltage (kV)
  --cs CS      Spherical abberation (mm)
  -w W         Amplitude contrast ratio
  --ps PS      Phase shift (deg)
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">parse_ctf_csparc</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn parse_ctf_csparc -h
usage: cryodrgn parse_ctf_csparc [-h] -o O [--png PNG] [-D D] [--Apix APIX] cs

Parse CTF parameters from a cryoSPARC particles.cs file

positional arguments:
  cs           Input cryosparc particles.cs file

optional arguments:
  -h, --help   show this help message and exit
  -o O         Output pkl of CTF parameters
  --png PNG    Optionally plot the CTF

Optionally provide missing image parameters:
  -D D         Image size in pixels
  --Apix APIX  Angstroms per pixel
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>We can extract the CTF parameters from the deposited Parameters.star file:</p>
<ul>
<li><p>Example command:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cryodrgn</span> <span class="pre">parse_ctf_star</span> <span class="pre">Parameters.star</span> <span class="pre">--Apix</span> <span class="pre">1.31</span> <span class="pre">-D</span> <span class="pre">320</span> <span class="pre">-o</span> <span class="pre">ctf.pkl</span> <span class="pre">--ps</span> <span class="pre">0</span></code></p>
<ul>
<li><p>Example output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cryodrgn</span><span class="p">)</span> <span class="p">[</span><span class="n">Wed</span> <span class="n">Feb</span> <span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span> <span class="n">empiar10076</span><span class="p">]</span> <span class="n">cryodrgn</span> <span class="n">parse_ctf_star</span> <span class="n">Parameters</span><span class="o">.</span><span class="n">star</span> <span class="o">--</span><span class="n">Apix</span> <span class="mf">1.31</span> <span class="o">-</span><span class="n">D</span> <span class="mi">320</span> <span class="o">-</span><span class="n">o</span> <span class="n">ctf</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">ps</span> <span class="mi">0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="mi">131899</span> <span class="n">particles</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">Overriding</span> <span class="n">phase</span> <span class="n">shift</span> <span class="k">with</span> <span class="mf">0.0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">CTF</span> <span class="n">parameters</span> <span class="k">for</span> <span class="n">first</span> <span class="n">particle</span><span class="p">:</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">Image</span> <span class="n">size</span> <span class="p">(</span><span class="n">pix</span><span class="p">)</span>  <span class="p">:</span> <span class="mi">320</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">A</span><span class="o">/</span><span class="n">pix</span>             <span class="p">:</span> <span class="mf">1.31</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">DefocusU</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">15301.1</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">DefocusV</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">14916.4</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">Dfang</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>       <span class="p">:</span> <span class="mf">5.28</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">voltage</span> <span class="p">(</span><span class="n">kV</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">300.0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">cs</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>           <span class="p">:</span> <span class="mf">2.7</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">w</span>                 <span class="p">:</span> <span class="mf">0.07</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">Phase</span> <span class="n">shift</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">33</span>     <span class="n">Saving</span> <span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">sparky</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">cryosparc</span><span class="o">/</span><span class="n">l17_davis_cell</span><span class="o">/</span><span class="n">raw_stack</span><span class="o">/</span><span class="n">ctf</span><span class="o">.</span><span class="n">pkl</span>
</pre></div>
</div>
</li>
<li><p>The pixel size ( <code class="docutils literal notranslate"><span class="pre">--Apix</span> <span class="pre">1.31</span></code>), image size (<code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">320</span></code>), and phase shift (<code class="docutils literal notranslate"><span class="pre">--ps</span> <span class="pre">0</span></code>) are provided separately since they are not present in the .star file.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>This metadata is also present in the cryoSPARC refinement .cs file. Below is an example usage of <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">parse_ctf_csparc</span></code> to extract the CTF information from the <code class="docutils literal notranslate"><span class="pre">cryosparc_P4_J33_004_particles.cs</span></code> file:</p>
<ul>
<li><p>Example command:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cryodrgn</span> <span class="pre">parse_ctf_csparc</span> <span class="pre">cryosparc_P4_J33_004_particles.cs</span> <span class="pre">-o</span> <span class="pre">ctf.pkl</span></code></p>
<ul>
<li><p>Example output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cryodrgn</span><span class="p">)</span> <span class="p">[</span><span class="n">Wed</span> <span class="n">Feb</span> <span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">13</span> <span class="n">het</span><span class="p">]</span> <span class="n">cryodrgn</span> <span class="n">parse_ctf_csparc</span> <span class="n">empiar10076</span><span class="o">/</span><span class="n">P4</span><span class="o">/</span><span class="n">J33</span><span class="o">/</span><span class="n">cryosparc_P4_J33_004_particles</span><span class="o">.</span><span class="n">cs</span> <span class="o">-</span><span class="n">o</span> <span class="n">ctf</span><span class="o">.</span><span class="n">pkl</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="mi">131899</span> <span class="n">particles</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">Image</span> <span class="n">size</span> <span class="p">(</span><span class="n">pix</span><span class="p">)</span>  <span class="p">:</span> <span class="mi">320</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">A</span><span class="o">/</span><span class="n">pix</span>             <span class="p">:</span> <span class="mf">1.309999942779541</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">DefocusU</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">15301.099609375</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">DefocusV</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">14916.400390625</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">Dfang</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>       <span class="p">:</span> <span class="mf">5.280000044476548</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">voltage</span> <span class="p">(</span><span class="n">kV</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">300.0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">cs</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>           <span class="p">:</span> <span class="mf">2.700000047683716</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">w</span>                 <span class="p">:</span> <span class="mf">0.07000000029802322</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">Phase</span> <span class="n">shift</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">52</span>     <span class="n">Saving</span> <span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryoem</span><span class="o">/</span><span class="n">vae3d</span><span class="o">/</span><span class="mi">00</span><span class="n">_data</span><span class="o">/</span><span class="n">empiar10076</span><span class="o">/</span><span class="n">het</span><span class="o">/</span><span class="n">ctf</span><span class="o">.</span><span class="n">pkl</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<section id="downsample-images">
<span id="step3-3"></span><h3>3.3) Downsample images<a class="headerlink" href="#downsample-images" title="Link to this heading">ÔÉÅ</a></h3>
<p>CryoDRGN training time is highly dependent on the image size (See Fig. 2E in Zhong et al.). We will downsample images to an image size of <strong>D=128</strong> (where D is the image dimension in pixels, i.e. a 128x128 image) using <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">downsample</span></code>. Later on, we will train a higher resolution model using larger images (<strong>D=256</strong>).</p>
<p>Because of the tradeoffs between training time and representation capacity of the neural networks, we recommend training on images with a maximum of D=256. In general, to optimize training time, we encourage using the smallest possible image size given the desired/expected resolution of the final density maps and their motions. Here, using an image size of (256x256) corresponds to a pixel size of 1.31*320/256 = 1.6375 A/pix and a Nyquist resolution of 3.275 A, which is still below the resolutions of the published density maps (~4-5 A).</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">downsample</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn downsample -h
usage: cryodrgn downsample [-h] -D D -o MRCS [-b B] [--is-vol] [--chunk CHUNK] [--datadir DATADIR] [--max-threads MAX_THREADS] mrcs

Downsample an image stack or volume by clipping fourier frequencies

positional arguments:
  mrcs                  Input particles or volume (.mrc, .mrcs, .star, or .txt)

optional arguments:
  -h, --help            show this help message and exit
  -D D                  New box size in pixels, must be even
  -o MRCS               Output projection stack (.mrcs)
  -b B                  Batch size for processing images (default: 5000)
  --is-vol              Flag if input .mrc is a volume
  --chunk CHUNK         Chunksize (in # of images) to split particle stack when saving
  --datadir DATADIR     Optionally provide path to input .mrcs if loading from a .star or .cs file
  --max-threads MAX_THREADS
                        Maximum number of CPU cores for parallelization (default: 16)
</pre></div>
</div>
</li>
</ul>
<p><strong>Downsample to D=256</strong></p>
<ul>
<li><p>First downsample our input file <code class="docutils literal notranslate"><span class="pre">L17Combine_weight_local.mrcs</span></code> to an image size of D=256, saved as the output file <code class="docutils literal notranslate"><span class="pre">particles.256.mrcs</span></code>.</p>
<ul>
<li><p>Example command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>cryodrgn<span class="w"> </span>downsample<span class="w"> </span>L17Combine_weight_local.mrcs<span class="w"> </span>-D<span class="w"> </span><span class="m">256</span><span class="w"> </span>-o<span class="w"> </span>particles.256.mrcs<span class="w"> </span>--chunk<span class="w"> </span><span class="m">50000</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">--chunk</span> <span class="pre">50000</span></code> flag to chunk the output into separate .mrcs containing 50k images each to avoid out-of-memory errors when saving out a large particle stack. Now, instead of a single output file, downsampled images will be stored in three separate .mrcs files  (<code class="docutils literal notranslate"><span class="pre">particles.256.0.mrcs</span></code>, <code class="docutils literal notranslate"><span class="pre">particles.256.1.mrcs</span></code>, and <code class="docutils literal notranslate"><span class="pre">particles.256.2.mrcs</span></code>), the first two containing 50k images, and the third with the remaining 31,899 images, and a text file, <code class="docutils literal notranslate"><span class="pre">particles.256.txt</span></code> listing the three .mrcs files.</p></li>
<li><p>Note: Chunked .mrcs files that are listed in a .txt file can contain either absolute paths or relative paths. By default the .txt file will only contain the file names (therefore it must remain in the same directory as the .mrcs).</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Downsample to D=128</strong></p>
<ul>
<li><p>Next downsample our D=256 particles to D=128. Example command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>$<span class="w"> </span>cryodrgn<span class="w"> </span>downsample<span class="w"> </span>particles.256.txt<span class="w"> </span>-D<span class="w"> </span><span class="m">128</span><span class="w"> </span>-o<span class="w"> </span>particles.128.mrcs
</pre></div>
</div>
<ul class="simple">
<li><p>The downsampled image stack will be 8.1GB</p></li>
<li><p>Note: You can also downsample from the original particles; it is faster (and equivalent) to do so from the smaller D=256 images.</p></li>
</ul>
</li>
</ul>
<p><strong>Additional usage notes</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">downsample</span></code> can also be used to downsample volumes using the <code class="docutils literal notranslate"><span class="pre">--is-vol</span></code> argument.</p></li>
<li><p>The input format to specify the particle stack may also be a <code class="docutils literal notranslate"><span class="pre">.star</span></code> file or a <code class="docutils literal notranslate"><span class="pre">.cs</span></code> file.</p>
<ul>
<li><p>If the paths to the .mrcs particles given by the .star/.cs file are broken, you can overwrite them using the argument <code class="docutils literal notranslate"><span class="pre">--datadir</span> <span class="pre">[PATH</span> <span class="pre">TO</span> <span class="pre">DIRECTORY</span> <span class="pre">WITH</span> <span class="pre">.MRCS]</span></code> . In some cases, the <code class="docutils literal notranslate"><span class="pre">--datadir</span></code> path should point to the <em>project directory</em> in order to complete relative file paths given in the .star/.cs file.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="cryodrgn-training">
<h2>4) CryoDRGN training<a class="headerlink" href="#cryodrgn-training" title="Link to this heading">ÔÉÅ</a></h2>
<p>When the input image stack (.mrcs), image poses (.pkl), and CTF parameters (.pkl) have been prepared, a cryoDRGN model can be trained with the following executable:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">train_vae</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn train_vae -h
usage: cryodrgn train_vae [-h] -o OUTDIR --zdim ZDIM --poses POSES [--ctf pkl] [--load WEIGHTS.PKL] [--checkpoint CHECKPOINT]
                          [--log-interval LOG_INTERVAL] [-v] [--seed SEED] [--ind PKL] [--uninvert-data] [--no-window] [--window-r WINDOW_R]
                          [--datadir DATADIR] [--lazy] [--preprocessed] [--max-threads MAX_THREADS] [--tilt TILT] [--tilt-deg TILT_DEG] [-n NUM_EPOCHS]
                          [-b BATCH_SIZE] [--wd WD] [--lr LR] [--beta BETA] [--beta-control BETA_CONTROL] [--norm NORM NORM] [--amp] [--multigpu]
                          [--do-pose-sgd] [--pretrain PRETRAIN] [--emb-type {s2s2,quat}] [--pose-lr POSE_LR] [--enc-layers QLAYERS] [--enc-dim QDIM]
                          [--encode-mode {conv,resid,mlp,tilt}] [--enc-mask ENC_MASK] [--use-real] [--dec-layers PLAYERS] [--dec-dim PDIM]
                          [--pe-type {geom_ft,geom_full,geom_lowf,geom_nohighf,linear_lowf,gaussian,none}] [--feat-sigma FEAT_SIGMA] [--pe-dim PE_DIM]
                          [--domain {hartley,fourier}] [--activation {relu,leaky_relu}]
                          particles

Train a VAE for heterogeneous reconstruction with known pose

positional arguments:
  particles             Input particles (.mrcs, .star, .cs, or .txt)

optional arguments:
  -h, --help            show this help message and exit
  -o OUTDIR, --outdir OUTDIR
                        Output directory to save model
  --zdim ZDIM           Dimension of latent variable
  --poses POSES         Image poses (.pkl)
  --ctf pkl             CTF parameters (.pkl)
  --load WEIGHTS.PKL    Initialize training from a checkpoint
  --checkpoint CHECKPOINT
                        Checkpointing interval in N_EPOCHS (default: 1)
  --log-interval LOG_INTERVAL
                        Logging interval in N_IMGS (default: 1000)
  -v, --verbose         Increaes verbosity
  --seed SEED           Random seed

Dataset loading:
  --ind PKL             Filter particle stack by these indices
  --uninvert-data       Do not invert data sign
  --no-window           Turn off real space windowing of dataset
  --window-r WINDOW_R   Windowing radius (default: 0.85)
  --datadir DATADIR     Path prefix to particle stack if loading relative paths from a .star or .cs file
  --lazy                Lazy loading if full dataset is too large to fit in memory (Should copy dataset to SSD)
  --preprocessed        Skip preprocessing steps if input data is from cryodrgn preprocess_mrcs
  --max-threads MAX_THREADS
                        Maximum number of CPU cores for FFT parallelization (default: 16)

Tilt series:
  --tilt TILT           Particles (.mrcs)
  --tilt-deg TILT_DEG   X-axis tilt offset in degrees (default: 45)

Training parameters:
  -n NUM_EPOCHS, --num-epochs NUM_EPOCHS
                        Number of training epochs (default: 20)
  -b BATCH_SIZE, --batch-size BATCH_SIZE
                        Minibatch size (default: 8)
  --wd WD               Weight decay in Adam optimizer (default: 0)
  --lr LR               Learning rate in Adam optimizer (default: 0.0001)
  --beta BETA           Choice of beta schedule or a constant for KLD weight (default: 1/zdim)
  --beta-control BETA_CONTROL
                        KL-Controlled VAE gamma. Beta is KL target. (default: None)
  --norm NORM NORM      Data normalization as shift, 1/scale (default: 0, std of dataset)
  --amp                 Accelerate training speed with mixed-precision training
  --multigpu            Parallelize training across all detected GPUs

Pose SGD:
  --do-pose-sgd         Refine poses with gradient descent
  --pretrain PRETRAIN   Number of epochs with fixed poses before pose SGD (default: 1)
  --emb-type {s2s2,quat}
                        SO(3) embedding type for pose SGD (default: quat)
  --pose-lr POSE_LR     Learning rate for pose optimizer (default: 0.0003)

Encoder Network:
  --enc-layers QLAYERS  Number of hidden layers (default: 3)
  --enc-dim QDIM        Number of nodes in hidden layers (default: 256)
  --encode-mode {conv,resid,mlp,tilt}
                        Type of encoder network (default: resid)
  --enc-mask ENC_MASK   Circular mask of image for encoder (default: D/2; -1 for no mask)
  --use-real            Use real space image for encoder (for convolutional encoder)

Decoder Network:
  --dec-layers PLAYERS  Number of hidden layers (default: 3)
  --dec-dim PDIM        Number of nodes in hidden layers (default: 256)
  --pe-type {geom_ft,geom_full,geom_lowf,geom_nohighf,linear_lowf,gaussian,none}
                        Type of positional encoding (default: geom_lowf)
  --feat-sigma FEAT_SIGMA
                        Scale for random Gaussian features
  --pe-dim PE_DIM       Num features in positional encoding (default: image D)
  --domain {hartley,fourier}
                        Decoder representation domain (default: fourier)
  --activation {relu,leaky_relu}
                        Activation (default: relu)
</pre></div>
</div>
</li>
</ul>
<p>Many of the parameters of this script have sensible defaults. The required arguments are:</p>
<ul class="simple">
<li><p>an input image stack (<code class="docutils literal notranslate"><span class="pre">.mrcs</span></code>¬†or other listed file types)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--poses</span></code>, image poses (<code class="docutils literal notranslate"><span class="pre">.pkl</span></code>) that correspond to the input images (see <a class="reference internal" href="#step3-1"><span class="std std-ref">Step 3.1</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ctf</span></code>, ctf parameters (<code class="docutils literal notranslate"><span class="pre">.pkl</span></code>), unless phase-flipped images are used (see <a class="reference internal" href="#step3-2"><span class="std std-ref">Step 3.2</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--zdim</span></code>, the dimension of the latent variable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span></code>, a clean output directory for storing results</p></li>
</ul>
<p>Additional parameters which are typically set include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>, Number of epochs to train</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--uninvert-data</span></code>, A flag to invert the image sign if particles are dark on light (i.e. negative stain format)</p></li>
<li><p>Neural network architecture settings with¬†<code class="docutils literal notranslate"><span class="pre">--enc-layers</span></code>,¬†<code class="docutils literal notranslate"><span class="pre">--enc-dim</span></code>,¬†<code class="docutils literal notranslate"><span class="pre">--dec-layers</span></code>,¬†<code class="docutils literal notranslate"><span class="pre">--dec-dim</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--multigpu</span></code>¬†to enable parallelized training across multiple GPUs (fast!)</p></li>
</ul>
<section id="general-recommended-workflow">
<h3>General recommended workflow**<a class="headerlink" href="#general-recommended-workflow" title="Link to this heading">ÔÉÅ</a></h3>
<ol class="arabic simple">
<li><p>First, train on lower resolution images (e.g. D=128)¬†using the default architecture (fast) as an initial pass to sanity check results and remove junk particles. <strong>(D=128, default 256x3 architecture)</strong></p></li>
<li><p>After any particle filtering, then train a larger model with the <code class="docutils literal notranslate"><span class="pre">--enc-dim</span> <span class="pre">1024</span></code> and <code class="docutils literal notranslate"><span class="pre">--dec-dim</span> <span class="pre">1024</span></code> arguments, which in theory can learn more heterogeneity. <strong>(D=128, large 1024x3 architecture)</strong></p></li>
<li><p>Finally, after validation, pose optimization, and any necessary particle filtering, then train on the full resolution image stack (up to D=256) with a large architecture. <strong>(D=256, large 1024x3 architecture)</strong></p></li>
</ol>
<p>In this tutorial we will walk through the commands and analysis for Step 1 and Step 3 in the above workflow. You can run step 2 on your own to see how the results compare.</p>
<section id="cryodrgn-initial-training">
<h4>CryoDRGN initial training<a class="headerlink" href="#cryodrgn-initial-training" title="Link to this heading">ÔÉÅ</a></h4>
<ul>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">train_vae</span></code> on the full particle stack of D=128 particles (1 GPU; 64GB memory requirement)</p>
<p>Example command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryodrgn<span class="w"> </span>train_vae<span class="w"> </span>data/128/particles.128.mrcs<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ctf<span class="w"> </span>data/ctf.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">	</span>--poses<span class="w"> </span>data/poses.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">	</span>--zdim<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">	</span>-n<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="se">\</span>
<span class="w">	</span>--uninvert-data<span class="w"> </span><span class="se">\ </span><span class="c1"># NOTE: Use this flag only if particles are dark-on-light (negative stain format)</span>
<span class="w">	</span>-o<span class="w"> </span>tutorial/00_vae128<span class="w"> </span>&gt;<span class="w"> </span>tutorial_00.log
</pre></div>
</div>
<p>Inputs:</p>
<ul class="simple">
<li><p>particles (.mrcs, .star, .txt, or .cs) format, here <code class="docutils literal notranslate"><span class="pre">data/128/particles.128.mrcs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ctf</span></code> ctf parameters in a cryodrgn .pkl file, here <code class="docutils literal notranslate"><span class="pre">data/ctf.pkl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--poses</span></code> poses in a cryodrgn .pkl file, here <code class="docutils literal notranslate"><span class="pre">data/poses.pkl</span></code></p></li>
</ul>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--zdim</span> <span class="pre">8</span></code> to specify the dimension of the latent variable (i.e. each particle will get assigned an 8-dimensional vector as its <em>latent embedding</em>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">50</span></code> to specify 50 epochs of training (i.e. 50 iterations through the dataset)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">tutorial/00</span></code>, a clean output directory (will get created if it does not already exist)</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">--uninvert-data</span></code> flag to flip the data sign of the particles dataset (This flag is not needed for the majority of cryo-EM datasets)</p></li>
</ul>
<p>Outputs:</p>
<ul>
<li><p>Log</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">01</span>     <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">cryodrgn4</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">cryodrgn</span> <span class="n">train_vae</span> <span class="n">data</span><span class="o">/</span><span class="mi">128</span><span class="o">/</span><span class="n">projections</span><span class="mf">.128</span><span class="o">.</span><span class="n">mrcs</span> <span class="o">--</span><span class="n">ctf</span> <span class="n">data</span><span class="o">/</span><span class="n">ctf</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">poses</span> <span class="n">data</span><span class="o">/</span><span class="n">pose</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">zdim</span> <span class="mi">8</span> <span class="o">-</span><span class="n">n</span> <span class="mi">50</span> <span class="o">-</span><span class="n">o</span> <span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">01</span>     <span class="n">Namespace</span><span class="p">(</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beta_control</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ctf</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/ctf.new.pkl&#39;</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_pose_sgd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;fourier&#39;</span><span class="p">,</span> <span class="n">emb_type</span><span class="o">=</span><span class="s1">&#39;quat&#39;</span><span class="p">,</span> <span class="n">enc_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encode_mode</span><span class="o">=</span><span class="s1">&#39;resid&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">main</span> <span class="n">at</span> <span class="mh">0x2000ab052840</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">invert_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">multigpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00&#39;</span><span class="p">,</span> <span class="n">particles</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/128/projections.128.mrcs&#39;</span><span class="p">,</span> <span class="n">pdim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">pe_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pe_type</span><span class="o">=</span><span class="s1">&#39;geom_lowf&#39;</span><span class="p">,</span> <span class="n">players</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pose_lr</span><span class="o">=</span><span class="mf">0.0003</span><span class="p">,</span> <span class="n">poses</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/pose.pkl&#39;</span><span class="p">,</span> <span class="n">pretrain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">qdim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">qlayers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">relion31</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">43266</span><span class="p">,</span> <span class="n">tilt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tilt_deg</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">use_real</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zdim</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">01</span>     <span class="n">Use</span> <span class="n">cuda</span> <span class="kc">True</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">09</span>     <span class="n">Loaded</span> <span class="mi">131899</span> <span class="mi">128</span><span class="n">x128</span> <span class="n">images</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span>     <span class="n">Normalized</span> <span class="n">HT</span> <span class="n">by</span> <span class="mi">0</span> <span class="o">+/-</span> <span class="mf">278.593719482421</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">Loading</span> <span class="n">ctf</span> <span class="n">params</span> <span class="kn">from</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">ctf</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">pkl</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">Image</span> <span class="n">size</span> <span class="p">(</span><span class="n">pix</span><span class="p">)</span>  <span class="p">:</span> <span class="mi">128</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">A</span><span class="o">/</span><span class="n">pix</span>             <span class="p">:</span> <span class="mf">3.2750000953674316</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">DefocusU</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">15301.099609375</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">DefocusV</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">14916.400390625</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">Dfang</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>       <span class="p">:</span> <span class="mf">5.28000020980835</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">voltage</span> <span class="p">(</span><span class="n">kV</span><span class="p">)</span>      <span class="p">:</span> <span class="mf">300.0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">cs</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>           <span class="p">:</span> <span class="mf">2.700000047683716</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">w</span>                 <span class="p">:</span> <span class="mf">0.07000000029802322</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">Phase</span> <span class="n">shift</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">04</span>     <span class="n">Using</span> <span class="n">circular</span> <span class="n">lattice</span> <span class="k">with</span> <span class="n">radius</span> <span class="mi">64</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">05</span>     <span class="n">HetOnlyVAE</span><span class="p">(</span>
  <span class="p">(</span><span class="n">encoder</span><span class="p">):</span> <span class="n">ResidLinearMLP</span><span class="p">(</span>
    <span class="p">(</span><span class="n">main</span><span class="p">):</span> <span class="n">Sequential</span><span class="p">(</span>
      <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">12852</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
      <span class="p">(</span><span class="mi">2</span><span class="p">):</span> <span class="n">ResidLinear</span><span class="p">(</span>
        <span class="p">(</span><span class="n">linear</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
      <span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="n">ResidLinear</span><span class="p">(</span>
        <span class="p">(</span><span class="n">linear</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
      <span class="p">(</span><span class="mi">6</span><span class="p">):</span> <span class="n">ResidLinear</span><span class="p">(</span>
        <span class="p">(</span><span class="n">linear</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="mi">7</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
      <span class="p">(</span><span class="mi">8</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="n">decoder</span><span class="p">):</span> <span class="n">FTPositionalDecoder</span><span class="p">(</span>
    <span class="p">(</span><span class="n">decoder</span><span class="p">):</span> <span class="n">ResidLinearMLP</span><span class="p">(</span>
      <span class="p">(</span><span class="n">main</span><span class="p">):</span> <span class="n">Sequential</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">392</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">):</span> <span class="n">ResidLinear</span><span class="p">(</span>
          <span class="p">(</span><span class="n">linear</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="n">ResidLinear</span><span class="p">(</span>
          <span class="p">(</span><span class="n">linear</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
        <span class="p">(</span><span class="mi">6</span><span class="p">):</span> <span class="n">ResidLinear</span><span class="p">(</span>
          <span class="p">(</span><span class="n">linear</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="mi">7</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
        <span class="p">(</span><span class="mi">8</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">05</span>     <span class="mi">3790354</span> <span class="n">parameters</span> <span class="ow">in</span> <span class="n">model</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">11</span>     <span class="c1"># [Train Epoch: 1/50] [1000/131899 images] gen loss=1.044404, kld=2.817325, beta=0.125000, loss=1.044431</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">14</span>     <span class="c1"># [Train Epoch: 1/50] [2000/131899 images] gen loss=1.039896, kld=7.318097, beta=0.125000, loss=1.039967</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">17</span>     <span class="c1"># [Train Epoch: 1/50] [3000/131899 images] gen loss=1.010868, kld=8.658796, beta=0.125000, loss=1.010953</span>

<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>

<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">24</span>     <span class="c1"># [Train Epoch: 50/50] [126000/131899 images] gen loss=0.989016, kld=26.381516, beta=0.125000, loss=0.989272</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">28</span>     <span class="c1"># [Train Epoch: 50/50] [127000/131899 images] gen loss=0.948055, kld=24.869091, beta=0.125000, loss=0.948297</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">31</span>     <span class="c1"># [Train Epoch: 50/50] [128000/131899 images] gen loss=1.017258, kld=25.462738, beta=0.125000, loss=1.017505</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">35</span>     <span class="c1"># [Train Epoch: 50/50] [129000/131899 images] gen loss=1.033358, kld=30.238625, beta=0.125000, loss=1.033653</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">38</span>     <span class="c1"># [Train Epoch: 50/50] [130000/131899 images] gen loss=0.966860, kld=24.983553, beta=0.125000, loss=0.967103</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">41</span>     <span class="c1"># [Train Epoch: 50/50] [131000/131899 images] gen loss=0.982898, kld=25.034485, beta=0.125000, loss=0.983141</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">44</span>     <span class="c1"># =====&gt; Epoch: 50 Average gen loss = 0.998177, KLD = 26.589939, total loss = 0.998435; Finished in 0:07:27.660706</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">18</span>     <span class="n">Finsihed</span> <span class="ow">in</span> <span class="mi">6</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mf">17.244481</span> <span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">18.344890</span> <span class="n">per</span> <span class="n">epoch</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>The training will take ~7.5 min/epoch on a V100 GPU, requiring ~7 hours total. The output directory will contain the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> a configuration file containing all inputs and settings for the job</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weights.pkl</span></code> the final neural network weights (and intermediate checkpoints <code class="docutils literal notranslate"><span class="pre">weights.n.pkl</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">z.pkl</span></code> the final per-particle latent embeddings (and embeddings from intermediate epochs <code class="docutils literal notranslate"><span class="pre">z.n.pkl</span></code>)</p></li>
</ul>
<p>Note you can use <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> to analyze intermediate epochs during training.</p>
</li>
</ul>
</section>
<section id="extending-or-restarting-from-a-checkpoint">
<h4>Extending or restarting from a checkpoint<a class="headerlink" href="#extending-or-restarting-from-a-checkpoint" title="Link to this heading">ÔÉÅ</a></h4>
<p>If the run was interrupted before it reached the desired number of epochs or you would like to train longer, a training job can be extended with the¬†<code class="docutils literal notranslate"><span class="pre">--load</span></code>¬†argument. For example, to resume training that was interrupted at epoch 24:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the same command with extra --load argument</span>
$<span class="w"> </span>cryodrgn<span class="w"> </span>train_vae<span class="w"> </span>data/128/particles.128.mrcs<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ctf<span class="w"> </span>data/ctf.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--poses<span class="w"> </span>data/poses.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--zdim<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-n<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--uninvert-data<span class="w"> </span><span class="se">\ </span><span class="c1"># NOTE: Use this flag only if particles are dark-on-light (negative stain format)</span>
<span class="w">    </span>--load<span class="w"> </span>tutorial/00_vae128/weights.24.pkl<span class="w"> </span><span class="se">\ </span><span class="c1"># 0-based indexing</span>
<span class="w">    </span>-o<span class="w"> </span>tutorial/00_vae128<span class="w"> </span>&gt;&gt;<span class="w"> </span>tutorial.00.log
</pre></div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">--load</span> <span class="pre">latest</span></code>, and cryodrgn will try to detect the latest set of model weights in the specified workdir.</p>
</section>
</section>
</section>
<section id="cryodrgn-analysis">
<h2>5) cryoDRGN analysis<a class="headerlink" href="#cryodrgn-analysis" title="Link to this heading">ÔÉÅ</a></h2>
<p>Once the model has finished training, use the <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> command to visualize the latent space, generate density maps, and generate template Jupyter notebooks for further interactive filtering, visualization, and analysis.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cryodrgn</span> <span class="pre">analyze</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn analyze -h
usage: cryodrgn analyze [-h] [--device DEVICE] [-o OUTDIR] [--skip-vol]
                        [--skip-umap] [--Apix APIX] [--flip] [-d DOWNSAMPLE]
                        [--pc PC] [--ksample KSAMPLE]
                        workdir epoch

Visualize latent space and generate volumes

positional arguments:
  workdir               Directory with cryoDRGN results
  epoch                 Epoch number N to analyze (0-based indexing,
                        corresponding to z.N.pkl, weights.N.pkl)

optional arguments:
  -h, --help            show this help message and exit
  --device DEVICE       Optionally specify CUDA device
  -o OUTDIR, --outdir OUTDIR
                        Output directory for analysis results (default:
                        [workdir]/analyze.[epoch])
  --skip-vol            Skip generation of volumes
  --skip-umap           Skip running UMAP

Extra arguments for volume generation:
  --Apix APIX           Pixel size to add to .mrc header (default: 1 A/pix)
  --flip                Flip handedness of output volume
  -d DOWNSAMPLE, --downsample DOWNSAMPLE
                        Downsample volumes to this box size (pixels)
  --pc PC               Number of principal component traversals to generate
                        (default: 2)
  --ksample KSAMPLE     Number of kmeans samples to generate (default: 20)
  --vol-start-index VOL_START_INDEX
                        Default value of start index for volume generation (default: 0)
</pre></div>
</div>
</li>
</ul>
<p>This script runs a series of standard analyses that will be further described below:</p>
<ul class="simple">
<li><p>PCA and UMAP visualizations of the particle latent embeddings</p></li>
<li><p>Generation of volumes from the latent embeddings at kmeans cluster centers</p></li>
<li><p>Generation of trajectories along the first and second principal components of the latent embeddings</p></li>
<li><p>Generation of a template jupyter notebook that may be used for further interactive analyses, visualization, and volume generation</p></li>
<li><p>(New in v0.3.2) Generation of a template jupyter notebook that may be used for particle filtering</p></li>
<li><p>(New in v2.2.0) Generation of a template jupyter notebook for adjusting any of the output figures</p></li>
</ul>
<p>Example command to run cryodrgn analyze on the directory <code class="docutils literal notranslate"><span class="pre">tutorial/00_vae128</span></code> and the trained weights from epoch 49 (0-based indexing) (1 GPU; ~5 min)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Usage: cryodrgn analyze [workdir] [epoch]</span>
$<span class="w"> </span>cryodrgn<span class="w"> </span>analyze<span class="w"> </span>tutorial/00_vae128<span class="w"> </span><span class="m">49</span><span class="w"> </span>--flip<span class="w"> </span>--Apix<span class="w"> </span><span class="m">3</span>.275
</pre></div>
</div>
<ul>
<li><p>Example output log</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cryodrgn4</span><span class="p">)</span> <span class="p">[</span><span class="n">Thu</span> <span class="n">Feb</span> <span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span> <span class="mi">00</span><span class="p">]</span> <span class="n">cryodrgn</span> <span class="n">analyze</span> <span class="o">.</span> <span class="mi">49</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">18</span>     <span class="n">Saving</span> <span class="n">results</span> <span class="n">to</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">18</span>     <span class="n">Perfoming</span> <span class="n">principal</span> <span class="n">component</span> <span class="n">analysis</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">18</span>     <span class="n">Explained</span> <span class="n">variance</span> <span class="n">ratio</span><span class="p">:</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">18</span>     <span class="p">[</span><span class="mf">0.22400902</span> <span class="mf">0.2087886</span>  <span class="mf">0.16459696</span> <span class="mf">0.10960732</span> <span class="mf">0.09572161</span> <span class="mf">0.07636773</span>
 <span class="mf">0.06840914</span> <span class="mf">0.05249962</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">18</span>     <span class="n">Generating</span> <span class="n">volumes</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">18</span>     <span class="n">Running</span> <span class="n">command</span><span class="p">:</span>
<span class="n">cryodrgn</span> <span class="n">eval_vol</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">weights</span><span class="mf">.49</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">config</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">zfile</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">pc1</span><span class="o">/</span><span class="n">z_values</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">pc1</span> <span class="o">--</span><span class="n">Apix</span> <span class="mi">1</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">20</span>     <span class="n">Use</span> <span class="n">cuda</span> <span class="kc">True</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">20</span>     <span class="n">Namespace</span><span class="p">(</span><span class="n">Apix</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/config.yaml&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enc_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encode_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">func</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">main</span> <span class="n">at</span> <span class="mh">0x7ffed8e3fe18</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">l_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/analyze.49/pc1&#39;</span><span class="p">,</span> <span class="n">pdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pe_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pe_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">players</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;vol_&#39;</span><span class="p">,</span> <span class="n">qdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qlayers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/weights.49.pkl&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zfile</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/analyze.49/pc1/z_values.txt&#39;</span><span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">20</span>     <span class="n">Loaded</span> <span class="n">configuration</span><span class="p">:</span>
<span class="p">{</span><span class="s1">&#39;dataset_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ctf&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/ctf.new.pkl&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;datadir&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;do_pose_sgd&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="s1">&#39;ind&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;invert_data&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="s1">&#39;keepreal&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">278.59372</span><span class="p">],</span>
                  <span class="s1">&#39;particles&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/128/projections.128.mrcs&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;poses&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/pose.pkl&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
 <span class="s1">&#39;lattice_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span> <span class="s1">&#39;extent&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;ignore_DC&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
 <span class="s1">&#39;model_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="s1">&#39;fourier&#39;</span><span class="p">,</span>
                <span class="s1">&#39;enc_mask&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
                <span class="s1">&#39;encode_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;resid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;pdim&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s1">&#39;pe_dim&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;pe_type&#39;</span><span class="p">:</span> <span class="s1">&#39;geom_lowf&#39;</span><span class="p">,</span>
                <span class="s1">&#39;players&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;qdim&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s1">&#39;qlayers&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;zdim&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>
 <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">43266</span><span class="p">}</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">29</span>     <span class="n">Using</span> <span class="n">circular</span> <span class="n">lattice</span> <span class="k">with</span> <span class="n">radius</span> <span class="mi">64</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">30</span>     <span class="n">Generating</span> <span class="mi">10</span> <span class="n">volumes</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">30</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.46911267</span> <span class="o">-</span><span class="mf">0.69718513</span> <span class="o">-</span><span class="mf">0.0095188</span>  <span class="o">-</span><span class="mf">2.78874987</span>  <span class="mf">0.1540933</span>   <span class="mf">0.16372231</span>
  <span class="mf">0.31355665</span>  <span class="mf">2.17943362</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">32</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.39820911</span> <span class="o">-</span><span class="mf">0.56545639</span> <span class="o">-</span><span class="mf">0.01828557</span> <span class="o">-</span><span class="mf">2.24070284</span>  <span class="mf">0.12997294</span>  <span class="mf">0.12582034</span>
  <span class="mf">0.25060696</span>  <span class="mf">1.75664491</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">33</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.32730555</span> <span class="o">-</span><span class="mf">0.43372764</span> <span class="o">-</span><span class="mf">0.02705235</span> <span class="o">-</span><span class="mf">1.69265581</span>  <span class="mf">0.10585258</span>  <span class="mf">0.08791838</span>
  <span class="mf">0.18765726</span>  <span class="mf">1.33385621</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">34</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.25640199</span> <span class="o">-</span><span class="mf">0.3019989</span>  <span class="o">-</span><span class="mf">0.03581912</span> <span class="o">-</span><span class="mf">1.14460877</span>  <span class="mf">0.08173222</span>  <span class="mf">0.05001641</span>
  <span class="mf">0.12470757</span>  <span class="mf">0.91106751</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">35</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.18549843</span> <span class="o">-</span><span class="mf">0.17027016</span> <span class="o">-</span><span class="mf">0.0445859</span>  <span class="o">-</span><span class="mf">0.59656174</span>  <span class="mf">0.05761186</span>  <span class="mf">0.01211444</span>
  <span class="mf">0.06175788</span>  <span class="mf">0.48827881</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">36</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.11459487</span> <span class="o">-</span><span class="mf">0.03854141</span> <span class="o">-</span><span class="mf">0.05335267</span> <span class="o">-</span><span class="mf">0.04851471</span>  <span class="mf">0.0334915</span>  <span class="o">-</span><span class="mf">0.02578752</span>
 <span class="o">-</span><span class="mf">0.00119181</span>  <span class="mf">0.06549011</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">36</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.04369131</span>  <span class="mf">0.09318733</span> <span class="o">-</span><span class="mf">0.06211945</span>  <span class="mf">0.49953232</span>  <span class="mf">0.00937114</span> <span class="o">-</span><span class="mf">0.06368949</span>
 <span class="o">-</span><span class="mf">0.0641415</span>  <span class="o">-</span><span class="mf">0.35729859</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">37</span>     <span class="p">[</span> <span class="mf">0.02721225</span>  <span class="mf">0.22491608</span> <span class="o">-</span><span class="mf">0.07088622</span>  <span class="mf">1.04757935</span> <span class="o">-</span><span class="mf">0.01474922</span> <span class="o">-</span><span class="mf">0.10159146</span>
 <span class="o">-</span><span class="mf">0.12709119</span> <span class="o">-</span><span class="mf">0.78008729</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">38</span>     <span class="p">[</span> <span class="mf">0.09811581</span>  <span class="mf">0.35664482</span> <span class="o">-</span><span class="mf">0.079653</span>    <span class="mf">1.59562638</span> <span class="o">-</span><span class="mf">0.03886958</span> <span class="o">-</span><span class="mf">0.13949343</span>
 <span class="o">-</span><span class="mf">0.19004089</span> <span class="o">-</span><span class="mf">1.20287599</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">39</span>     <span class="p">[</span> <span class="mf">0.16901937</span>  <span class="mf">0.48837357</span> <span class="o">-</span><span class="mf">0.08841977</span>  <span class="mf">2.14367342</span> <span class="o">-</span><span class="mf">0.06298993</span> <span class="o">-</span><span class="mf">0.17739539</span>
 <span class="o">-</span><span class="mf">0.25299058</span> <span class="o">-</span><span class="mf">1.62566469</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">40</span>     <span class="n">Finsihed</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">19.785367</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">40</span>     <span class="n">Running</span> <span class="n">command</span><span class="p">:</span>
<span class="n">cryodrgn</span> <span class="n">eval_vol</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">weights</span><span class="mf">.49</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">config</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">zfile</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">pc2</span><span class="o">/</span><span class="n">z_values</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">pc2</span> <span class="o">--</span><span class="n">Apix</span> <span class="mi">1</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">42</span>     <span class="n">Use</span> <span class="n">cuda</span> <span class="kc">True</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">42</span>     <span class="n">Namespace</span><span class="p">(</span><span class="n">Apix</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/config.yaml&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enc_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encode_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">func</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">main</span> <span class="n">at</span> <span class="mh">0x7ffea04efe18</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">l_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/analyze.49/pc2&#39;</span><span class="p">,</span> <span class="n">pdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pe_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pe_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">players</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;vol_&#39;</span><span class="p">,</span> <span class="n">qdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qlayers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/weights.49.pkl&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zfile</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/analyze.49/pc2/z_values.txt&#39;</span><span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">42</span>     <span class="n">Loaded</span> <span class="n">configuration</span><span class="p">:</span>
<span class="p">{</span><span class="s1">&#39;dataset_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ctf&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/ctf.new.pkl&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;datadir&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;do_pose_sgd&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="s1">&#39;ind&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;invert_data&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="s1">&#39;keepreal&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">278.59372</span><span class="p">],</span>
                  <span class="s1">&#39;particles&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/128/projections.128.mrcs&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;poses&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/pose.pkl&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
 <span class="s1">&#39;lattice_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span> <span class="s1">&#39;extent&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;ignore_DC&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
 <span class="s1">&#39;model_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="s1">&#39;fourier&#39;</span><span class="p">,</span>
                <span class="s1">&#39;enc_mask&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
                <span class="s1">&#39;encode_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;resid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;pdim&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s1">&#39;pe_dim&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;pe_type&#39;</span><span class="p">:</span> <span class="s1">&#39;geom_lowf&#39;</span><span class="p">,</span>
                <span class="s1">&#39;players&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;qdim&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s1">&#39;qlayers&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;zdim&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>
 <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">43266</span><span class="p">}</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">44</span>     <span class="n">Using</span> <span class="n">circular</span> <span class="n">lattice</span> <span class="k">with</span> <span class="n">radius</span> <span class="mi">64</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">44</span>     <span class="n">Generating</span> <span class="mi">10</span> <span class="n">volumes</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">44</span>     <span class="p">[</span> <span class="mf">1.294627</span>   <span class="o">-</span><span class="mf">0.24291033</span> <span class="o">-</span><span class="mf">1.22768164</span>  <span class="mf">0.23142111</span> <span class="o">-</span><span class="mf">0.33955064</span>  <span class="mf">0.78482312</span>
 <span class="o">-</span><span class="mf">2.50019564</span>  <span class="mf">1.20387314</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">45</span>     <span class="p">[</span> <span class="mf">0.99771195</span> <span class="o">-</span><span class="mf">0.20620808</span> <span class="o">-</span><span class="mf">0.98250969</span>  <span class="mf">0.14853748</span> <span class="o">-</span><span class="mf">0.26071324</span>  <span class="mf">0.61755447</span>
 <span class="o">-</span><span class="mf">1.97648029</span>  <span class="mf">0.98551235</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">46</span>     <span class="p">[</span> <span class="mf">0.70079691</span> <span class="o">-</span><span class="mf">0.16950582</span> <span class="o">-</span><span class="mf">0.73733774</span>  <span class="mf">0.06565385</span> <span class="o">-</span><span class="mf">0.18187584</span>  <span class="mf">0.45028583</span>
 <span class="o">-</span><span class="mf">1.45276495</span>  <span class="mf">0.76715156</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">47</span>     <span class="p">[</span> <span class="mf">0.40388187</span> <span class="o">-</span><span class="mf">0.13280357</span> <span class="o">-</span><span class="mf">0.49216579</span> <span class="o">-</span><span class="mf">0.01722978</span> <span class="o">-</span><span class="mf">0.10303843</span>  <span class="mf">0.28301718</span>
 <span class="o">-</span><span class="mf">0.9290496</span>   <span class="mf">0.54879077</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">48</span>     <span class="p">[</span> <span class="mf">0.10696682</span> <span class="o">-</span><span class="mf">0.09610131</span> <span class="o">-</span><span class="mf">0.24699384</span> <span class="o">-</span><span class="mf">0.1001134</span>  <span class="o">-</span><span class="mf">0.02420103</span>  <span class="mf">0.11574853</span>
 <span class="o">-</span><span class="mf">0.40533425</span>  <span class="mf">0.33042997</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">48</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.18994822</span> <span class="o">-</span><span class="mf">0.05939906</span> <span class="o">-</span><span class="mf">0.00182189</span> <span class="o">-</span><span class="mf">0.18299703</span>  <span class="mf">0.05463638</span> <span class="o">-</span><span class="mf">0.05152012</span>
  <span class="mf">0.1183811</span>   <span class="mf">0.11206918</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">49</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.48686326</span> <span class="o">-</span><span class="mf">0.02269681</span>  <span class="mf">0.24335006</span> <span class="o">-</span><span class="mf">0.26588066</span>  <span class="mf">0.13347378</span> <span class="o">-</span><span class="mf">0.21878876</span>
  <span class="mf">0.64209644</span> <span class="o">-</span><span class="mf">0.10629161</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">50</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.78377831</span>  <span class="mf">0.01400545</span>  <span class="mf">0.48852201</span> <span class="o">-</span><span class="mf">0.34876429</span>  <span class="mf">0.21231118</span> <span class="o">-</span><span class="mf">0.38605741</span>
  <span class="mf">1.16581179</span> <span class="o">-</span><span class="mf">0.3246524</span> <span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">51</span>     <span class="p">[</span><span class="o">-</span><span class="mf">1.08069335</span>  <span class="mf">0.0507077</span>   <span class="mf">0.73369396</span> <span class="o">-</span><span class="mf">0.43164792</span>  <span class="mf">0.29114859</span> <span class="o">-</span><span class="mf">0.55332606</span>
  <span class="mf">1.68952714</span> <span class="o">-</span><span class="mf">0.54301319</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">52</span>     <span class="p">[</span><span class="o">-</span><span class="mf">1.37760839</span>  <span class="mf">0.08740996</span>  <span class="mf">0.97886591</span> <span class="o">-</span><span class="mf">0.51453155</span>  <span class="mf">0.36998599</span> <span class="o">-</span><span class="mf">0.7205947</span>
  <span class="mf">2.21324248</span> <span class="o">-</span><span class="mf">0.76137398</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">53</span>     <span class="n">Finsihed</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">10.702840</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">53</span>     <span class="n">K</span><span class="o">-</span><span class="n">means</span> <span class="n">clustering</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">00</span>     <span class="n">Generating</span> <span class="n">volumes</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">00</span>     <span class="n">Running</span> <span class="n">command</span><span class="p">:</span>
<span class="n">cryodrgn</span> <span class="n">eval_vol</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">weights</span><span class="mf">.49</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">config</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">zfile</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">kmeans20</span><span class="o">/</span><span class="n">z_values</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">kmeans20</span> <span class="o">--</span><span class="n">Apix</span> <span class="mi">1</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">02</span>     <span class="n">Use</span> <span class="n">cuda</span> <span class="kc">True</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">02</span>     <span class="n">Namespace</span><span class="p">(</span><span class="n">Apix</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/config.yaml&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enc_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encode_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">func</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">main</span> <span class="n">at</span> <span class="mh">0x7ffeb2fded90</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">l_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/analyze.49/kmeans20&#39;</span><span class="p">,</span> <span class="n">pdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pe_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pe_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">players</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;vol_&#39;</span><span class="p">,</span> <span class="n">qdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qlayers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/weights.49.pkl&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zfile</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/tutorial/00/analyze.49/kmeans20/z_values.txt&#39;</span><span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">02</span>     <span class="n">Loaded</span> <span class="n">configuration</span><span class="p">:</span>
<span class="p">{</span><span class="s1">&#39;dataset_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ctf&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/ctf.new.pkl&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;datadir&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;do_pose_sgd&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="s1">&#39;ind&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;invert_data&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="s1">&#39;keepreal&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">278.59372</span><span class="p">],</span>
                  <span class="s1">&#39;particles&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/128/projections.128.mrcs&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;poses&#39;</span><span class="p">:</span> <span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/pose.pkl&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
 <span class="s1">&#39;lattice_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span> <span class="s1">&#39;extent&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;ignore_DC&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
 <span class="s1">&#39;model_args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="s1">&#39;fourier&#39;</span><span class="p">,</span>
                <span class="s1">&#39;enc_mask&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
                <span class="s1">&#39;encode_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;resid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;pdim&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s1">&#39;pe_dim&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;pe_type&#39;</span><span class="p">:</span> <span class="s1">&#39;geom_lowf&#39;</span><span class="p">,</span>
                <span class="s1">&#39;players&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;qdim&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s1">&#39;qlayers&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;zdim&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>
 <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">43266</span><span class="p">}</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">04</span>     <span class="n">Using</span> <span class="n">circular</span> <span class="n">lattice</span> <span class="k">with</span> <span class="n">radius</span> <span class="mi">64</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">04</span>     <span class="n">Generating</span> <span class="mi">20</span> <span class="n">volumes</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">04</span>     <span class="p">[</span>  <span class="mf">2.47612858</span>   <span class="mf">1.90699387</span>  <span class="o">-</span><span class="mf">6.04850197</span>   <span class="mf">5.43400908</span>   <span class="mf">0.27650252</span>
 <span class="o">-</span><span class="mf">24.12995529</span>  <span class="o">-</span><span class="mf">2.3250308</span>    <span class="mf">3.7706964</span> <span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">05</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.38294414</span>  <span class="mf">0.05903612</span> <span class="o">-</span><span class="mf">0.07340568</span> <span class="o">-</span><span class="mf">2.14857912</span> <span class="o">-</span><span class="mf">1.43606532</span> <span class="o">-</span><span class="mf">6.48859549</span>
 <span class="o">-</span><span class="mf">1.28178108</span>  <span class="mf">0.9746204</span> <span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">05</span>     <span class="p">[</span> <span class="mf">0.75751173</span> <span class="o">-</span><span class="mf">1.02667093</span>  <span class="mf">1.90755236</span> <span class="o">-</span><span class="mf">3.46744156</span> <span class="o">-</span><span class="mf">0.51795393</span> <span class="o">-</span><span class="mf">0.53410876</span>
 <span class="o">-</span><span class="mf">0.6747672</span>  <span class="o">-</span><span class="mf">0.07184201</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">06</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.39390403</span> <span class="o">-</span><span class="mf">4.45507717</span>  <span class="mf">1.54359567</span> <span class="o">-</span><span class="mf">3.08658767</span> <span class="o">-</span><span class="mf">0.37659553</span>  <span class="mf">0.12258258</span>
 <span class="o">-</span><span class="mf">0.59937257</span> <span class="o">-</span><span class="mf">0.22234169</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">07</span>     <span class="p">[</span> <span class="mf">1.00644302</span> <span class="o">-</span><span class="mf">0.63465279</span> <span class="o">-</span><span class="mf">1.0577668</span>   <span class="mf">1.89774811</span> <span class="o">-</span><span class="mf">0.28295705</span>  <span class="mf">0.83203548</span>
 <span class="o">-</span><span class="mf">2.69281244</span>  <span class="mf">0.79193765</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">08</span>     <span class="p">[</span> <span class="mf">1.25866413</span>  <span class="mf">0.96147162</span> <span class="o">-</span><span class="mf">1.38003922</span> <span class="o">-</span><span class="mf">0.0860692</span>  <span class="o">-</span><span class="mf">0.73352259</span>  <span class="mf">0.40986091</span>
 <span class="o">-</span><span class="mf">2.08615518</span>  <span class="mf">0.60404295</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">09</span>     <span class="p">[</span> <span class="mf">1.66666162</span> <span class="o">-</span><span class="mf">0.26700783</span> <span class="o">-</span><span class="mf">0.10245889</span> <span class="o">-</span><span class="mf">0.29272029</span>  <span class="mf">0.68260807</span>  <span class="mf">0.62163264</span>
 <span class="o">-</span><span class="mf">0.88520497</span>  <span class="mf">0.98171395</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">09</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.57202214</span>  <span class="mf">0.37561724</span>  <span class="mf">0.12516868</span>  <span class="mf">1.5115962</span>  <span class="o">-</span><span class="mf">0.3613039</span>  <span class="o">-</span><span class="mf">0.3017866</span>
 <span class="o">-</span><span class="mf">0.60656387</span> <span class="o">-</span><span class="mf">1.45335865</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">10</span>     <span class="p">[</span> <span class="mf">0.74015254</span>  <span class="mf">0.34087622</span>  <span class="mf">0.30410638</span>  <span class="mf">0.71546018</span> <span class="o">-</span><span class="mf">0.03811092</span> <span class="o">-</span><span class="mf">0.17879301</span>
  <span class="mf">0.25628883</span> <span class="o">-</span><span class="mf">1.22579646</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">11</span>     <span class="p">[</span> <span class="mf">0.44719604</span> <span class="o">-</span><span class="mf">0.2432248</span>  <span class="o">-</span><span class="mf">0.52932549</span> <span class="o">-</span><span class="mf">0.70396465</span>  <span class="mf">0.50919217</span>  <span class="mf">0.10998529</span>
  <span class="mf">2.3488977</span>   <span class="mf">0.93258661</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">12</span>     <span class="p">[</span><span class="o">-</span><span class="mf">1.04071832</span>  <span class="mf">0.60200369</span>  <span class="mf">0.23502171</span>  <span class="mf">0.22022174</span>  <span class="mf">0.9593488</span>  <span class="o">-</span><span class="mf">0.15067071</span>
  <span class="mf">2.34484267</span> <span class="o">-</span><span class="mf">1.02382338</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">12</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.94867486</span> <span class="o">-</span><span class="mf">0.89667982</span>  <span class="mf">0.93049031</span>  <span class="mf">0.47582638</span>  <span class="mf">0.52237713</span> <span class="o">-</span><span class="mf">0.64064002</span>
  <span class="mf">2.15901017</span> <span class="o">-</span><span class="mf">0.40877968</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">13</span>     <span class="p">[</span> <span class="mf">1.14693427</span>  <span class="mf">0.93310452</span> <span class="o">-</span><span class="mf">0.19505537</span> <span class="o">-</span><span class="mf">2.90435362</span> <span class="o">-</span><span class="mf">1.93226695</span>  <span class="mf">0.3056525</span>
  <span class="mf">0.80431372</span>  <span class="mf">1.23579288</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">14</span>     <span class="p">[</span><span class="o">-</span><span class="mf">2.20564294</span>  <span class="mf">0.6484825</span>  <span class="o">-</span><span class="mf">1.06616759</span> <span class="o">-</span><span class="mf">2.64037299</span> <span class="o">-</span><span class="mf">2.2968111</span>  <span class="o">-</span><span class="mf">0.86852956</span>
  <span class="mf">1.28031063</span>  <span class="mf">0.94097143</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">15</span>     <span class="p">[</span><span class="o">-</span><span class="mf">1.80046439</span>  <span class="mf">2.30461287</span>  <span class="mf">1.092592</span>   <span class="o">-</span><span class="mf">2.74578357</span> <span class="o">-</span><span class="mf">1.52575612</span> <span class="o">-</span><span class="mf">0.99183404</span>
 <span class="o">-</span><span class="mf">0.01311122</span> <span class="o">-</span><span class="mf">0.26105565</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">15</span>     <span class="p">[</span><span class="o">-</span><span class="mf">1.050125</span>   <span class="o">-</span><span class="mf">0.81217915</span>  <span class="mf">0.75083983</span> <span class="o">-</span><span class="mf">1.61578703</span> <span class="o">-</span><span class="mf">0.43990365</span>  <span class="mf">0.25753841</span>
  <span class="mf">0.10831033</span>  <span class="mf">3.08369875</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">16</span>     <span class="p">[</span> <span class="mf">0.02014027</span> <span class="o">-</span><span class="mf">1.22502518</span> <span class="o">-</span><span class="mf">0.98093748</span> <span class="o">-</span><span class="mf">0.37346572</span>  <span class="mf">1.85765135</span>  <span class="mf">1.13682508</span>
  <span class="mf">0.9183864</span>   <span class="mf">2.5960722</span> <span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">17</span>     <span class="p">[</span><span class="o">-</span><span class="mf">0.11215129</span>  <span class="mf">0.1362886</span>   <span class="mf">0.1612342</span>  <span class="o">-</span><span class="mf">3.04565883</span>  <span class="mf">1.92077279</span>  <span class="mf">0.20085585</span>
 <span class="o">-</span><span class="mf">1.72337461</span>  <span class="mf">1.19097638</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">18</span>     <span class="p">[</span><span class="o">-</span><span class="mf">2.51964045</span> <span class="o">-</span><span class="mf">0.48837739</span>  <span class="mf">0.40034276</span> <span class="o">-</span><span class="mf">2.05232668</span> <span class="o">-</span><span class="mf">1.27610278</span> <span class="o">-</span><span class="mf">0.68975723</span>
 <span class="o">-</span><span class="mf">2.2069602</span>   <span class="mf">0.2000891</span> <span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">18</span>     <span class="p">[</span><span class="o">-</span><span class="mf">3.26598477</span> <span class="o">-</span><span class="mf">0.72640318</span>  <span class="mf">0.30290347</span> <span class="o">-</span><span class="mf">2.19951153</span>  <span class="mf">0.87410563</span> <span class="o">-</span><span class="mf">0.05870867</span>
 <span class="o">-</span><span class="mf">0.48441201</span>  <span class="mf">0.65784246</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">19</span>     <span class="n">Finsihed</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">17.491466</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">20</span>     <span class="n">Running</span> <span class="n">UMAP</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">03</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">20</span>     <span class="n">Generating</span> <span class="n">plots</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">03</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">38</span>     <span class="n">Creating</span> <span class="n">jupyter</span> <span class="n">notebook</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">03</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">38</span>     <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">cryoDRGN_viz</span><span class="o">.</span><span class="n">ipynb</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">03</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">38</span>     <span class="n">Creating</span> <span class="n">jupyter</span> <span class="n">notebook</span><span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">03</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">38</span>     <span class="o">/</span><span class="n">nobackup</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">zhonge</span><span class="o">/</span><span class="n">cryodrgn</span><span class="o">/</span><span class="mi">11</span><span class="n">_l17_ribo</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="n">analyze</span><span class="mf">.49</span><span class="o">/</span><span class="n">cryoDRGN_filtering</span><span class="o">.</span><span class="n">ipynb</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">03</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">38</span>     <span class="n">Finished</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">19.831017</span>
</pre></div>
</div>
</li>
</ul>
<section id="what-s-in-the-analysis-directory">
<h3><strong>What‚Äôs in the analysis directory?</strong><a class="headerlink" href="#what-s-in-the-analysis-directory" title="Link to this heading">ÔÉÅ</a></h3>
<p>Once <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> finishes, there will be a new directory, <code class="docutils literal notranslate"><span class="pre">analyze.49</span></code>, within the job directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn4<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>tutorial/00_vae128/analyze.49<span class="w"> </span><span class="c1"># path to analysis directory</span>
cryoDRGN_filtering.ipynb<span class="w">  </span>kmeans20<span class="w">  </span>pc2<span class="w">              </span>umap.pkl<span class="w">  </span>z_pca_hexbin.png
cryoDRGN_viz.ipynb<span class="w">        </span>pc1<span class="w">       </span>umap_hexbin.png<span class="w">  </span>umap.png<span class="w">  </span>z_pca.png
</pre></div>
</div>
</section>
<section id="visualization-of-the-latent-space">
<h3>Visualization of the latent space<a class="headerlink" href="#visualization-of-the-latent-space" title="Link to this heading">ÔÉÅ</a></h3>
<p>Because we trained a 8-dimensional latent variable model (<code class="docutils literal notranslate"><span class="pre">--zdim</span> <span class="pre">8</span></code>), each particle image is associated with an 8-D vector embedding (saved in <code class="docutils literal notranslate"><span class="pre">z.49.pkl</span></code> ). <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> runs PCA (a linear dimensionality reduction technique) and UMAP (a nonlinear dimensionality technique) to visualize these latent embeddings. These images will be found in the <code class="docutils literal notranslate"><span class="pre">analyze.49</span></code> directory:</p>
<p>PCA</p>
<p><img alt="z_pca.png" src="../_images/Untitled_6.png" /></p>
<p>z_pca.png</p>
<p>UMAP</p>
<p><img alt="z_pca_hexbin.png" src="../_images/Untitled_7.png" /></p>
<p>z_pca_hexbin.png</p>
<p><img alt="umap.png" src="../_images/Untitled_8.png" /></p>
<p>umap.png</p>
<p><img alt="umap_hexbin.png" src="../_images/Untitled_9.png" /></p>
<p>umap_hexbin.png</p>
<p>We can see there are 5 major clusters in the latent space similar to Figure 5A in Zhong et al. We will show how these align with the 4 major classes of the LSU ribosome + a fifth junk class, and how to remove the fifth junk class from the particle stack.</p>
</section>
<section id="sampled-density-maps">
<h3>Sampled density maps<a class="headerlink" href="#sampled-density-maps" title="Link to this heading">ÔÉÅ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">analyze.49</span></code> directory will also contain a subdirectory kmeans20 with representative reconstructed density maps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># contents of the directory</span>
<span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>tutorial/00_vae128/analyze.49/kmeans20/
centers_ind.txt<span class="w">  </span>umap.png<span class="w">     </span>vol_003.mrc<span class="w">  </span>vol_007.mrc<span class="w">  </span>vol_011.mrc<span class="w">  </span>vol_015.mrc<span class="w">  </span>vol_019.mrc
centers.txt<span class="w">      </span>vol_000.mrc<span class="w">  </span>vol_004.mrc<span class="w">  </span>vol_008.mrc<span class="w">  </span>vol_012.mrc<span class="w">  </span>vol_016.mrc<span class="w">  </span>z_pca_hex.png
labels.pkl<span class="w">       </span>vol_001.mrc<span class="w">  </span>vol_005.mrc<span class="w">  </span>vol_009.mrc<span class="w">  </span>vol_013.mrc<span class="w">  </span>vol_017.mrc<span class="w">  </span>z_pca.png
umap_hex.png<span class="w">     </span>vol_002.mrc<span class="w">  </span>vol_006.mrc<span class="w">  </span>vol_010.mrc<span class="w">  </span>vol_014.mrc<span class="w">  </span>vol_018.mrc<span class="w">  </span>z_values.txt
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> uses the <em>k</em>-means clustering algorithm to <em>partition</em> the latent space into  k regions (by default k=20), and generate a density map from the center of each of these clusters. The goal is to provide an initial set of summary density maps to visually inspect, not to assign clusters.</p>
<p><strong>Note:</strong> The number of volumes can be modified with the argument <code class="docutils literal notranslate"><span class="pre">--ksample</span> <span class="pre">50</span></code>.</p>
<iframe src="https://widgets.figshare.com/articles/21171049/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<p>The directory will also contain PCA and UMAP visualizations with annotations of where the 20 density maps were generated from.</p>
<p><img alt="" src="../_images/Untitled_10.png" /></p>
<p><img alt="" src="../_images/Untitled_11.png" /></p>
<p><img alt="" src="../_images/Untitled_12.png" /></p>
<p><img alt="" src="../_images/Untitled_13.png" /></p>
</section>
<section id="pc-trajectories">
<h3>PC trajectories<a class="headerlink" href="#pc-trajectories" title="Link to this heading">ÔÉÅ</a></h3>
<p>There are two subdirectories in the analysis directory that will contain volumes generated along the first and second principal components (PC) of the latent space. By default, the volumes are generated at equally spaced points between the first and 99th percentile of the data distribution projected onto each principal component (e.g. Fig 6c of Zhong et al).</p>
<ul class="simple">
<li><p>Note 1: The PC trajectories can give a sense of the variability in the structure, however, the principal components of cryoDRGN‚Äôs <em>latent space</em> are not principal components of the volumes due to the nonlinear nature of the decoder.</p></li>
<li><p>Note 2: Principal component trajectories can also produce nonphysical ‚Äúmotions‚Äù, e.g. if there is discrete variability in the structure.</p></li>
</ul>
<p>Additional usage notes:</p>
<ul class="simple">
<li><p>Use the flag  <code class="docutils literal notranslate"><span class="pre">--pc</span> <span class="pre">N</span></code>  to change the number of PCs that are generated by <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code></p></li>
<li><p>For more flexibility in the start and end points, and in the number of PCs trajectories, use <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">pc_traversal</span></code></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>tutorial/00_vae128/analyze.49/pc1/
umap.png<span class="w">     </span>vol_001.mrc<span class="w">  </span>vol_003.mrc<span class="w">  </span>vol_005.mrc<span class="w">  </span>vol_007.mrc<span class="w">  </span>vol_009.mrc
vol_000.mrc<span class="w">  </span>vol_002.mrc<span class="w">  </span>vol_004.mrc<span class="w">  </span>vol_006.mrc<span class="w">  </span>vol_008.mrc<span class="w">  </span>z_values.txt
<span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>tutorial/00_vae128/analyze.49/pc2/
umap.png<span class="w">     </span>vol_001.mrc<span class="w">  </span>vol_003.mrc<span class="w">  </span>vol_005.mrc<span class="w">  </span>vol_007.mrc<span class="w">  </span>vol_009.mrc
vol_000.mrc<span class="w">  </span>vol_002.mrc<span class="w">  </span>vol_004.mrc<span class="w">  </span>vol_006.mrc<span class="w">  </span>vol_008.mrc<span class="w">  </span>z_values.txt
</pre></div>
</div>
<p><img alt="UMAP embeddings colored by PC1 value (pc1/umap.png)" src="../_images/Untitled_14.png" />
<em>UMAP embeddings colored by PC1 value (pc1/umap.png)</em></p>
<iframe src="https://widgets.figshare.com/articles/21171568/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<p><em>PC1: vol_000.mrc to vol_009.mrc; This shows one of the assembly pathways from Davis et al where the central protuberance is built before the rest of the complex.</em></p>
<p><img alt="UMAP embeddings colored by PC2 value (pc2/umap.png)" src="../_images/Untitled_15.png" />
<em>UMAP embeddings colored by PC2 value (pc2/umap.png)</em></p>
<iframe src="https://widgets.figshare.com/articles/21171571/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<p><em>PC2: vol_000.mrc to vol_009.mrc; This shows another assembly pathway from Davis et al where the base is built before the rest of the complex.</em></p>
<p>The <code class="docutils literal notranslate"><span class="pre">umap.png</span></code> plot within the <code class="docutils literal notranslate"><span class="pre">pcX</span></code> subdirectories shows the UMAP embedding of each particle, colored by its PCX value. This helps give a sense of the layout of the latent space and how the UMAP embedding is related to the PCA projection.</p>
</section>
</section>
<section id="particle-filtering-with-the-cryodrgn-jupyter-notebook">
<h2>6) Particle filtering with the cryoDRGN Jupyter notebook<a class="headerlink" href="#particle-filtering-with-the-cryodrgn-jupyter-notebook" title="Link to this heading">ÔÉÅ</a></h2>
<p>This section will walk through how to use the cryoDRGN Jupyter notebook, <code class="docutils literal notranslate"><span class="pre">cryoDRGN_filtering.ipynb</span></code>, to filter junk particles out of the dataset. The Jupyter notebook provides an interactive environment for running Python code blocks to analyze the cryoDRGN results.</p>
<section id="accessing-the-jupyter-notebook">
<h3>6.1) Accessing the jupyter notebook<a class="headerlink" href="#accessing-the-jupyter-notebook" title="Link to this heading">ÔÉÅ</a></h3>
<p>Jupyter is a web application that requires a browser to use. If you have browser access on the machine where you ran the cryodrgn experiment, you can start the jupyter notebook from the command line with the command <code class="docutils literal notranslate"><span class="pre">jupyter-notebook</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>jupyter-notebook
<span class="o">[</span>I<span class="w"> </span><span class="m">14</span>:47:21.672<span class="w"> </span>NotebookApp<span class="o">]</span><span class="w"> </span>JupyterLab<span class="w"> </span>extension<span class="w"> </span>loaded<span class="w"> </span>from<span class="w"> </span>/Users/zhonge/anaconda3/envs/cryodrgn/lib/python3.7/site-packages/jupyterlab
<span class="o">[</span>I<span class="w"> </span><span class="m">14</span>:47:21.672<span class="w"> </span>NotebookApp<span class="o">]</span><span class="w"> </span>JupyterLab<span class="w"> </span>application<span class="w"> </span>directory<span class="w"> </span>is<span class="w"> </span>/Users/zhonge/anaconda3/envs/cryodrgn/share/jupyter/lab
<span class="o">[</span>I<span class="w"> </span><span class="m">14</span>:47:21.674<span class="w"> </span>NotebookApp<span class="o">]</span><span class="w"> </span>Serving<span class="w"> </span>notebooks<span class="w"> </span>from<span class="w"> </span><span class="nb">local</span><span class="w"> </span>directory:<span class="w"> </span>/Users/zhonge/dev/cryodrgn/master
<span class="o">[</span>I<span class="w"> </span><span class="m">14</span>:47:21.674<span class="w"> </span>NotebookApp<span class="o">]</span><span class="w"> </span>Jupyter<span class="w"> </span>Notebook<span class="w"> </span><span class="m">6</span>.1.4<span class="w"> </span>is<span class="w"> </span>running<span class="w"> </span>at:
<span class="o">[</span>I<span class="w"> </span><span class="m">14</span>:47:21.674<span class="w"> </span>NotebookApp<span class="o">]</span><span class="w"> </span>http://localhost:8888/?token<span class="o">=</span>6e54c833c7da8c8c6e7c418feeb0dbbc76b0752a82d114f3
<span class="o">[</span>I<span class="w"> </span><span class="m">14</span>:47:21.674<span class="w"> </span>NotebookApp<span class="o">]</span><span class="w">  </span>or<span class="w"> </span>http://127.0.0.1:8888/?token<span class="o">=</span>6e54c833c7da8c8c6e7c418feeb0dbbc76b0752a82d114f3
<span class="o">[</span>I<span class="w"> </span><span class="m">14</span>:47:21.674<span class="w"> </span>NotebookApp<span class="o">]</span><span class="w"> </span>Use<span class="w"> </span>Control-C<span class="w"> </span>to<span class="w"> </span>stop<span class="w"> </span>this<span class="w"> </span>server<span class="w"> </span>and<span class="w"> </span>shut<span class="w"> </span>down<span class="w"> </span>all<span class="w"> </span>kernels<span class="w"> </span><span class="o">(</span>twice<span class="w"> </span>to<span class="w"> </span>skip<span class="w"> </span>confirmation<span class="o">)</span>.
<span class="o">[</span>C<span class="w"> </span><span class="m">14</span>:47:21.689<span class="w"> </span>NotebookApp<span class="o">]</span>

<span class="w">    </span>To<span class="w"> </span>access<span class="w"> </span>the<span class="w"> </span>notebook,<span class="w"> </span>open<span class="w"> </span>this<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>browser:
<span class="w">        </span>file:///Users/zhonge/Library/Jupyter/runtime/nbserver-67879-open.html
<span class="w">    </span>Or<span class="w"> </span>copy<span class="w"> </span>and<span class="w"> </span>paste<span class="w"> </span>one<span class="w"> </span>of<span class="w"> </span>these<span class="w"> </span>URLs:
<span class="w">        </span>http://localhost:8888/?token<span class="o">=</span>6e54c833c7da8c8c6e7c418feeb0dbbc76b0752a82d114f3
<span class="w">     </span>or<span class="w"> </span>http://127.0.0.1:8888/?token<span class="o">=</span>6e54c833c7da8c8c6e7c418feeb0dbbc76b0752a82d114f3
</pre></div>
</div>
<p>If the cryodrgn training was performed on a <em>remote</em> machine (e.g. on a compute cluster), you can still view the notebook on your local machine (e.g. laptop) by setting up SSH port forwarding. For more information, see: <a class="reference external" href="https://docs.anaconda.com/anaconda/user-guide/tasks/remote-jupyter-notebook/">https://docs.anaconda.com/anaconda/user-guide/tasks/remote-jupyter-notebook/</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># on the remote machine, start the jupyter notebook server in the cryodrgn workdir</span>
<span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>jupyter-notebook<span class="w"> </span>--no-browser<span class="w"> </span>--port<span class="w"> </span><span class="m">8888</span><span class="w"> </span><span class="c1"># specify an arbitrary port number &gt; 1024</span>

<span class="c1"># on your local machine, open a unix terminal (or MS-DOS on Windows) and type the following command to set up the SSH tunnel</span>
$<span class="w"> </span>ssh<span class="w"> </span>-N<span class="w"> </span>-f<span class="w"> </span>-L<span class="w"> </span>localhost:8888:localhost:8888<span class="w"> </span>remote_username@remote_host_name<span class="w"> </span><span class="c1"># replace remote_username and remote_host_name with your login information</span>

<span class="c1"># then navigate to a browser and type in localhost:8888 in the address bar</span>
</pre></div>
</div>
<p>The port number can be set to an arbitrary number between 1024 through 49151 (as long as the port is unused). Jupyter should detect if a port is already in use and will automatically use the next (N+1) port number.</p>
<p>Here is a screenshot of the page that will show up in your browser. It should list all the files in that directory:</p>
<p><img alt="" src="../_images/Untitled_16.png" /></p>
<p>Then click cryoDRGN_filtering.ipynb to start the jupyter notebook:</p>
<p><img alt="" src="../_images/Untitled_17.png" /></p>
</section>
<section id="run-the-jupyter-notebook-for-particle-filtering">
<h3>6.2) Run the jupyter-notebook for particle filtering<a class="headerlink" href="#run-the-jupyter-notebook-for-particle-filtering" title="Link to this heading">ÔÉÅ</a></h3>
<p>The jupyter notebook has template code for performing all the analysis and plotting and should require minimal intervention. For a general overview of running jupyter notebooks, see their documentation here: <a class="reference external" href="https://jupyter.readthedocs.io/en/latest/running.html">https://jupyter.readthedocs.io/en/latest/running.html</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cryoDRGN_filtering.ipynb</span></code> jupyter notebook has three methods for filtering particles:</p>
<ol class="arabic simple">
<li><p>clustering of the latent embeddings (k-means or Gaussian mixture model)</p></li>
<li><p>outlier detection (Z-score)</p></li>
<li><p>interactive selection with a lasso tool</p></li>
</ol>
<p>For each method, the selected particles are tracked in the variable,¬†<code class="docutils literal notranslate"><span class="pre">ind_selected</span></code>.</p>
<p>Once the selection has been finalized, the selected particles are saved into the cryoDRGN workdir as a¬†<code class="docutils literal notranslate"><span class="pre">index.pkl</span></code>¬†file at the end of the notebook. The selected indices can then be provided to cryoDRGN with the¬†<code class="docutils literal notranslate"><span class="pre">--ind</span></code>¬†argument to train a new model on a subset of the images or converted to¬†<code class="docutils literal notranslate"><span class="pre">.star</span></code>¬†file format.</p>
<p>For this tutorial, we will use the first method (GMM clustering) to follow the methodology used in Zhong et al. (See Extended Data Fig. 5). However, we will also demo the other methods, which you are welcome to explore.</p>
<p>To get started, first make sure the epoch number in the third cell is set to the correct epoch that we are analyzing. Since we have trained for 50 epochs, it should be set to 49 (0-based indexing).</p>
<p><img alt="Set the variable EPOCH = N to the appropriate value." src="../_images/Untitled_18.png" /></p>
<p>Set the variable EPOCH = N to the appropriate value.</p>
<p>Then run the cells of the notebook to load the relevant results until the first ‚ÄúFiltering by Cluster‚Äù section.</p>
<section id="published-filtering-results">
<h4><strong>Published filtering results</strong><a class="headerlink" href="#published-filtering-results" title="Link to this heading">ÔÉÅ</a></h4>
<p>This section shows the tutorial results colored by the filtered particles in the original publication of the dataset (Davis et al) and in the cryoDRGN paper (Zhong et al). For prospective analysis, the ‚Äújunk‚Äù is usually identified by visualizing the reconstructed volumes and/or the particles images, and especially straightforward for edge/ice artifacts. The filtering may be validated by 2D classification or other traditional tools. In this dataset, the junk particles also have a very different pose distribution (not shown, but you can view this in the interactive visualization section of the jupyter notebook).</p>
<p>Davis et al 3D classification labels</p>
<p>(Optional) Add these code blocks in the jupyter notebook if you wish to generate these visualizations.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># deposited to https://zenodo.org/record/4355284</span>
<span class="nv">pub_classification_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>utils.load_pkl<span class="o">(</span><span class="s1">&#39;/path/to/published_labels_major.pkl&#39;</span><span class="o">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>analysis.plot_by_cluster<span class="o">(</span>pc<span class="o">[</span>:,0<span class="o">]</span>,<span class="w"> </span>pc<span class="o">[</span>:,1<span class="o">]</span>,<span class="w"> </span><span class="m">6</span>,<span class="w"> </span>pub_classification_labels<span class="o">)</span>
plt.xlabel<span class="o">(</span><span class="s1">&#39;PC1&#39;</span><span class="o">)</span>
plt.ylabel<span class="o">(</span><span class="s1">&#39;PC2&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p><img alt="assets/Untitled_19.png" src="../_images/Untitled_19.png" /></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>analysis.plot_by_cluster<span class="o">(</span>umap<span class="o">[</span>:,0<span class="o">]</span>,<span class="w"> </span>umap<span class="o">[</span>:,1<span class="o">]</span>,<span class="w"> </span><span class="m">6</span>,<span class="w"> </span>pub_classification_labels<span class="o">)</span>
plt.xlabel<span class="o">(</span><span class="s1">&#39;UMAP1&#39;</span><span class="o">)</span>
plt.ylabel<span class="o">(</span><span class="s1">&#39;UMAP2&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p><img alt="assets/Untitled_20.png" src="../_images/Untitled_20.png" /></p>
<p>Zhong et al. filtering results: 96,532 kept particles and 35,367 removed particles</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtained from https://github.com/zhonge/cryodrgn_empiar/blob/main/empiar10076/inputs/filtered.ind.pkl</span>
<span class="nv">pub_filtering</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>utils.load_pkl<span class="o">(</span><span class="s1">&#39;/path/to/filtered_ind.pkl&#39;</span><span class="o">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plt.scatter<span class="o">(</span>pc<span class="o">[</span>:,0<span class="o">]</span>,<span class="w"> </span>pc<span class="o">[</span>:,1<span class="o">]</span>,<span class="w"> </span><span class="nv">alpha</span><span class="o">=</span>.1,<span class="w"> </span><span class="nv">ms</span><span class="o">=</span><span class="m">1</span><span class="o">)</span>
plt.scatter<span class="o">(</span>pc<span class="o">[</span>pub_filtering,0<span class="o">]</span>,<span class="w"> </span>pc<span class="o">[</span>ind_filtering,1<span class="o">]</span>,<span class="w"> </span><span class="nv">alpha</span><span class="o">=</span>.1,<span class="w"> </span><span class="nv">ms</span><span class="o">=</span><span class="m">1</span><span class="o">)</span>
plt.xlabel<span class="o">(</span><span class="s1">&#39;PC1&#39;</span><span class="o">)</span>
plt.ylabel<span class="o">(</span><span class="s1">&#39;PC2&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p><img alt="Kept particles are shown in orange" src="../_images/Untitled_21.png" /></p>
<p>Kept particles are shown in orange</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plt.scatter<span class="o">(</span>pc<span class="o">[</span>:,0<span class="o">]</span>,<span class="w"> </span>pc<span class="o">[</span>:,1<span class="o">]</span>,<span class="w"> </span><span class="nv">alpha</span><span class="o">=</span>.1,<span class="w"> </span><span class="nv">ms</span><span class="o">=</span><span class="m">1</span><span class="o">)</span>
plt.scatter<span class="o">(</span>pc<span class="o">[</span>pub_filtering,0<span class="o">]</span>,<span class="w"> </span>pc<span class="o">[</span>ind_filtering,1<span class="o">]</span>,<span class="w"> </span><span class="nv">alpha</span><span class="o">=</span>.1,<span class="w"> </span><span class="nv">ms</span><span class="o">=</span><span class="m">1</span><span class="o">)</span>
plt.xlabel<span class="o">(</span><span class="s1">&#39;UMAP&#39;</span><span class="o">)</span>
plt.ylabel<span class="o">(</span><span class="s1">&#39;UMAP2&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p><img alt="Kept particles are shown in orange" src="../_images/Untitled_22.png" /></p>
<p>Kept particles are shown in orange</p>
<p>In the next section, we will show the steps to remove the center cluster in the UMAP corresponding to the junk particles (the brown cluster in the 3D classification labels).</p>
</section>
</section>
<section id="filtering-by-gmm-cluster-label">
<h3>6.3) <strong>Filtering by GMM cluster label</strong><a class="headerlink" href="#filtering-by-gmm-cluster-label" title="Link to this heading">ÔÉÅ</a></h3>
<p>In this section, we demo the steps and outputs for filtering out the junk cluster using a Gaussian mixture model (GMM) clustering algorithm.</p>
<p>The ‚ÄúFiltering by cluster‚Äù section of the Jupyter notebook has two subsections ‚Äî filtering by kmeans clustering and by GMM clustering. You can try both options and play around with the cluster # and the random seed.</p>
<p>In the GMM-clustering section, change the cluster number (G=6 here) and rerun as necessary to get the desired clustering. Because GMM is a non-deterministic algorithm, the results are sensitive to the initial random seed. You can rerun the cells to try a different random seed.</p>
<p>Note that the clustering is performed on the latent embedding (<code class="docutils literal notranslate"><span class="pre">z</span></code>) and not on the umap embeddings (<code class="docutils literal notranslate"><span class="pre">umap</span></code>). This can be experimented with as well.</p>
<p><img alt="assets/Untitled_23.png" src="../_images/Untitled_23.png" /></p>
<p><img alt="assets/Untitled_24.png" src="../_images/Untitled_24.png" /></p>
<ul class="simple">
<li><p>The resulting 6 clusters:</p></li>
</ul>
<p><img alt="assets/Untitled_25.png" src="../_images/Untitled_25.png" /></p>
<p><img alt="assets/Untitled_26.png" src="../_images/Untitled_26.png" /></p>
<p><img alt="assets/Untitled_27.png" src="../_images/Untitled_27.png" /></p>
<ul class="simple">
<li><p>Set clusters 2 and 5 (green and brown) as the bad/junk clusters. The code block will then identify the particles corresponding to those clusters.</p></li>
</ul>
<p><img alt="Select particles from clusters 2 and 5." src="../_images/Untitled_28.png" /></p>
<p>Select particles from clusters 2 and 5.</p>
<p><img alt="assets/Untitled_29.png" src="../_images/Untitled_29.png" /></p>
<p><img alt="assets/Untitled_30.png" src="../_images/Untitled_30.png" /></p>
<section id="alternative-method-filtering-by-z-score">
<h4>Alternative method: <strong>Filtering by z-score</strong><a class="headerlink" href="#alternative-method-filtering-by-z-score" title="Link to this heading">ÔÉÅ</a></h4>
<p>In practice, we often find that junk particles are located as outliers in the distribution of latent embeddings. This section selects outlier particles by the magnitude of the embedding.</p>
<p><img alt="In cell 59, you can change the zscore to make the cutoff more or less stringent." src="../_images/Untitled_31.png" /></p>
<p>In cell 59, you can change the zscore to make the cutoff more or less stringent.</p>
<p>These plots will be automatically generated that help visualize which particles are selected</p>
<p><img alt="assets/Untitled_32.png" src="../_images/Untitled_32.png" /></p>
<p><img alt="assets/Untitled_33.png" src="../_images/Untitled_33.png" /></p>
<p><img alt="assets/Untitled_34.png" src="../_images/Untitled_34.png" /></p>
</section>
<section id="alternative-method-filtering-with-an-interactive-lasso-tool">
<h4>Alternative method: <strong>Filtering with an interactive lasso tool</strong><a class="headerlink" href="#alternative-method-filtering-with-an-interactive-lasso-tool" title="Link to this heading">ÔÉÅ</a></h4>
<p>Sometimes, the best clustering algorithm is the human eye (e.g. kmeans/GMM clustering algorithms can fail especially for small/oddly-shaped clusters). The cryoDRGN_filtering.ipynb notebook also provides an interactive widget that lets you interactively select regions of the latent space using a lasso tool.</p>
<p>When the widget first shows up, you will need to change the x-axis and y-axis labels to plot the particles by their UMAP embeddings. You can also change the plotting colors.</p>
<p>Note: Sometimes the tool struggles when there are &gt;500k particles. This is a known issue.</p>
<p>Note: There have been installation issues with jupyter widgets on some linux systems. See <a class="reference external" href="https://github.com/zhonge/cryodrgn/issues/34">[link to github]</a>.</p>
<p><img alt="assets/Untitled_35.png" src="../_images/Untitled_35.png" /></p>
<p><img alt="assets/Untitled_36.png" src="../_images/Untitled_36.png" /></p>
<p><img alt="assets/Untitled_37.png" src="../_images/Untitled_37.png" /></p>
</section>
<section id="view-the-raw-particles">
<h4>View the raw particles<a class="headerlink" href="#view-the-raw-particles" title="Link to this heading">ÔÉÅ</a></h4>
<p>The second to last section of the jupyter notebook contains code blocks for viewing the raw particle images. This section will visualize 9 images at random from the selected particles. This is sometimes useful for verifying that the selected particles are problematic in obvious cases of junk particles.</p>
<p><img alt="Cell 89 can be rerun to view a different selection of particles." src="../_images/Untitled_38.png" /></p>
<p>Cell 89 can be rerun to view a different selection of particles.</p>
<p><img alt="9 randomly selected particles from ind_selected" src="../_images/Untitled_39.png" /></p>
<p>9 randomly selected particles from ind_selected</p>
<p><img alt="Location of the particles in latent space" src="../_images/Untitled_40.png" /></p>
<p>Location of the particles in latent space</p>
</section>
<section id="saving-the-selection">
<h4>Saving the selection<a class="headerlink" href="#saving-the-selection" title="Link to this heading">ÔÉÅ</a></h4>
<p>The last section of the notebook has cells that will help save the selected indices to use in downstream processing.</p>
<p><img alt="Screenshot of the section" src="../_images/Untitled_41.png" /></p>
<p><em>Screenshot of the section</em></p>
<p>In the filtering sections, the selected particles are tracked in the variable <code class="docutils literal notranslate"><span class="pre">ind_selected</span></code> and <code class="docutils literal notranslate"><span class="pre">ind_selected_not</span></code>. Because we selected the <em>bad particles</em>, we will now switch what the <code class="docutils literal notranslate"><span class="pre">ind_keep</span></code> and <code class="docutils literal notranslate"><span class="pre">ind_bad</span></code> variables are set to in the first cell. This is purely for organizational/file naming purposes.</p>
<p><img alt="Screen shot of the final section in cryoDRGN_filtering.ipynb" src="../_images/Untitled_42.png" />
<em>Screenshot of the final section in cryoDRGN_filtering.ipynb</em></p>
<p>Visualization of our kept particles, <code class="docutils literal notranslate"><span class="pre">ind_keep</span></code>:</p>
<p><img alt="Viewing the kept particles (orange) in PCA space" src="../_images/Untitled_43.png" /></p>
<p><em>Viewing the kept particles (orange) in PCA space</em></p>
<p><img alt="Viewing the kept particles (orange) in UMAP space" src="../_images/Untitled_44.png" /></p>
<p><em>Viewing the kept particles (orange) in UMAP space</em></p>
<p>The last three cells will print out a summary of the selection and where the indices were saved:</p>
<p><img alt="assets/Untitled_45.png" src="../_images/Untitled_45.png" /></p>
<p>After running these cells, there should be two files saved in the workdir of the cryodrgn job (the number of particles should be similar but most likely not identical):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ind_keep.96509_particles.pkl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ind_bad.35390_particles.pkl</span></code></p></li>
</ul>
<p>These <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> files contain a numpy array of indices into the particle stack, which can be provided to <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">train_vae</span></code> with the <code class="docutils literal notranslate"><span class="pre">--ind</span></code> flag to restrict training on the subset of the desired particle. This avoids having to extract a new particle stack.</p>
</section>
<section id="additional-functionality-writing-a-new-star-file">
<h4>(Additional Functionality) Writing a new .star file<a class="headerlink" href="#additional-functionality-writing-a-new-star-file" title="Link to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>The selected particles can be converted to a .star file using <code class="docutils literal notranslate"><span class="pre">cryodrgn_utils</span> <span class="pre">write_star</span></code>. See Section 8.3 for more details on this script.</p></li>
</ul>
</section>
<section id="additional-functionality-extracting-a-new-particle-stack">
<h4>(Additional Functionality) Extracting a new particle stack<a class="headerlink" href="#additional-functionality-extracting-a-new-particle-stack" title="Link to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>A new particle stack can be extracted using the script <code class="docutils literal notranslate"><span class="pre">filter_mrcs.py</span></code> found in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> subdirectory of the cryodrgn repository.</p></li>
</ul>
</section>
</section>
</section>
<section id="cryodrgn-high-resolution-training">
<h2>7) CryoDRGN high-resolution training<a class="headerlink" href="#cryodrgn-high-resolution-training" title="Link to this heading">ÔÉÅ</a></h2>
<p>Now that we have identified the junk particles, we will rerun <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">train_vae</span></code> on larger, higher resolution images (D=256) using a larger neural network model (1024 dim x 3 layer architecture).</p>
<p>Example command to run on 1 GPU</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryodrgn<span class="w"> </span>train_vae<span class="w"> </span>data/256/particles.256.txt<span class="w"> </span><span class="se">\</span>
<span class="w">										</span>--ctf<span class="w"> </span>data/ctf.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">										</span>--poses<span class="w"> </span>data/poses.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">										</span>--zdim<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">										</span>-n<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="se">\</span>
<span class="w">										</span>--uninvert-data<span class="w"> </span><span class="se">\ </span><span class="c1"># needed for this dataset</span>
<span class="w">										</span>--enc-dim<span class="w"> </span><span class="m">1024</span><span class="w"> </span>--enc-layers<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\ </span><span class="c1"># set the encoder architecture</span>
<span class="w">										</span>--dec-dim<span class="w"> </span><span class="m">1024</span><span class="w"> </span>--dec-layers<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\ </span><span class="c1"># set the decoder architecture</span>
<span class="w">										</span>--ind<span class="w"> </span>tutorial/00/ind_keep.96509_particles.pkl
<span class="w">										</span>-o<span class="w"> </span>tutorial/01_vae256<span class="w"> </span>&gt;<span class="w"> </span>tutorial_01.log
</pre></div>
</div>
<p>By providing the <code class="docutils literal notranslate"><span class="pre">--ind</span></code> argument, cryoDRGN will filter the list of particles, ctf parameters, and poses by the provided index array.</p>
<p>This is the most compute-intensive step of the tutorial. The training will take ~25 min/epoch on a single V100 GPU, requiring ~21 hours total for 50 epochs.</p>
<section id="accelerated-training-with-gpu-parallelization">
<h3><strong>Accelerated training with GPU parallelization</strong><a class="headerlink" href="#accelerated-training-with-gpu-parallelization" title="Link to this heading">ÔÉÅ</a></h3>
<p>Use cryoDRGN‚Äôs¬†<code class="docutils literal notranslate"><span class="pre">--multigpu</span></code>¬†flag to enable parallelized training across all detected GPUs on the machine. To select specific GPUs for cryoDRGN to run on, use the environmental variable¬†<code class="docutils literal notranslate"><span class="pre">CUDA_VISIBLE_DEVICES</span></code>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cryodrgn train_vae ... # Run on GPU 0
$ cryodrgn train_vae ... --multigpu # Run on all GPUs on the machine
$ CUDA_VISIBLE_DEVICES=0,3 cryodrgn train_vae ... --multigpu # Run on GPU 0,3
</pre></div>
</div>
<p>When training is parallelized across multiple GPUs, the batch size (number of images trained in each mini-batch of SGD; default¬†<code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">8</span></code>) will be automatically scaled by the number of available GPUs to better take advantage of parallelization. Depending on your compute resources, GPU utilization may be improved with¬†<code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">16</span></code>¬†(i.e. to achieve linear scaling of runtime with # GPUs). However, note that GPU parallelization, while leading to a faster wall-clock time per epoch, may require increasing the total number of epochs, since the training dynamics are affected (fewer model updates per epoch with larger¬†<code class="docutils literal notranslate"><span class="pre">-b</span></code>).</p>
</section>
<section id="accelerated-training-with-mixed-precision-mode">
<h3>Accelerated training with mixed-precision mode<a class="headerlink" href="#accelerated-training-with-mixed-precision-mode" title="Link to this heading">ÔÉÅ</a></h3>
<p>Mixed precision training is available for Nvidia GPUs with tensor core architectures and can lead to¬†<em>order of magnitude</em>¬†speedups in training. As of cryoDRGN version 1.1, mixed precision training is now automatically enabled (and can be turned off with the <code class="docutils literal notranslate"><span class="pre">--no-amp</span></code> flag).</p>
<p><strong>Note:</strong>¬†We recommend using¬†<code class="docutils literal notranslate"><span class="pre">--multigpu</span></code>¬†and¬†<code class="docutils literal notranslate"><span class="pre">--amp</span></code>¬†for larger architectures (1024x3) or larger images (D=256). For smaller models/images, GPU computation may not be the training bottleneck. In this case, GPU parallelization and mixed-precision training may have a limited effect on the wall clock training time, while taking up additional compute resources.</p>
</section>
</section>
<section id="analysis">
<h2>8) Analysis<a class="headerlink" href="#analysis" title="Link to this heading">ÔÉÅ</a></h2>
<p>We will first walk through the default outputs from <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> (Section 8.1), then we will use the cryoDRGN jupyter notebook to visualize and generate assembly state density maps (Section 8.2), extract the particles for newly identified state C4 (Section 8.3), and use cryoDRGN‚Äôs graph traversal algorithm to generate trajectories of a ribosome assembly pathways (Section 8.4).</p>
<section id="cryodrgn-analyze">
<h3>8.1) cryodrgn analyze<a class="headerlink" href="#cryodrgn-analyze" title="Link to this heading">ÔÉÅ</a></h3>
<p>Similar to Step 5 above, we first run the default analysis pipeline with <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> :</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cryodrgn</span> <span class="pre">analyze</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn analyze -h
usage: cryodrgn analyze [-h] [--device DEVICE] [-o OUTDIR] [--skip-vol]
                        [--skip-umap] [--Apix APIX] [--flip] [-d DOWNSAMPLE]
                        [--pc PC] [--ksample KSAMPLE]
                        workdir epoch

Visualize latent space and generate volumes

positional arguments:
  workdir               Directory with cryoDRGN results
  epoch                 Epoch number N to analyze (0-based indexing,
                        corresponding to z.N.pkl, weights.N.pkl)

optional arguments:
  -h, --help            show this help message and exit
  --device DEVICE       Optionally specify CUDA device
  -o OUTDIR, --outdir OUTDIR
                        Output directory for analysis results (default:
                        [workdir]/analyze.[epoch])
  --skip-vol            Skip generation of volumes
  --skip-umap           Skip running UMAP

Extra arguments for volume generation:
  --Apix APIX           Pixel size to add to .mrc header (default: 1 A/pix)
  --flip                Flip handedness of output volume
  -d DOWNSAMPLE, --downsample DOWNSAMPLE
                        Downsample volumes to this box size (pixels)
  --pc PC               Number of principal component traversals to generate
                        (default: 2)
  --ksample KSAMPLE     Number of kmeans samples to generate (default: 20)
  --vol-start-index VOL_START_INDEX
                        Default value of start index for volume generation (default: 0)
</pre></div>
</div>
</li>
</ul>
<p>Example command: (1 GPU, ~10 min)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Usage: cryodrgn analyze [workdir] [epoch]</span>
$<span class="w"> </span>cryodrgn<span class="w"> </span>analyze<span class="w"> </span>tutorial/01_vae256<span class="w"> </span><span class="m">49</span><span class="w"> </span>--Apix<span class="w"> </span><span class="m">1</span>.6375<span class="w"> </span>--flip
</pre></div>
</div>
<p>We flip the handedness of the output volumes with the flag <code class="docutils literal notranslate"><span class="pre">--flip</span></code> and set the pixel size in the mrc header with <code class="docutils literal notranslate"><span class="pre">--Apix</span></code>:</p>
<ul>
<li><p>Output log</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:49<span class="w">     </span>Saving<span class="w"> </span>results<span class="w"> </span>to<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:49<span class="w">     </span>Perfoming<span class="w"> </span>principal<span class="w"> </span>component<span class="w"> </span>analysis...
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:49<span class="w">     </span>Explained<span class="w"> </span>variance<span class="w"> </span>ratio:
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:49<span class="w">     </span><span class="o">[</span><span class="m">0</span>.21076616<span class="w"> </span><span class="m">0</span>.1977381<span class="w">  </span><span class="m">0</span>.11697037<span class="w"> </span><span class="m">0</span>.09955638<span class="w"> </span><span class="m">0</span>.0985605<span class="w">  </span><span class="m">0</span>.09767462
<span class="w"> </span><span class="m">0</span>.09139399<span class="w"> </span><span class="m">0</span>.08733987<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:49<span class="w">     </span>Generating<span class="w"> </span>volumes...
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:49<span class="w">     </span>Running<span class="w"> </span>command:
cryodrgn<span class="w"> </span>eval_vol<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/weights.49.pkl<span class="w"> </span>--config<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/config.yaml<span class="w"> </span>--zfile<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc1/z_values.txt<span class="w"> </span>-o<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc1<span class="w"> </span>--Apix<span class="w"> </span><span class="m">1</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:50<span class="w">     </span>Use<span class="w"> </span>cuda<span class="w"> </span>True
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:50<span class="w">     </span>Namespace<span class="o">(</span><span class="nv">Apix</span><span class="o">=</span><span class="m">1</span>.0,<span class="w"> </span><span class="nv">D</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span>,<span class="w"> </span><span class="nv">config</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/config.yaml&#39;</span>,<span class="w"> </span><span class="nv">domain</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">downsample</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">enc_mask</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">encode_mode</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">flip</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">func</span><span class="o">=</span>&lt;<span class="k">function</span><span class="w"> </span>main<span class="w"> </span>at<span class="w"> </span>0x2000ac580e18&gt;,<span class="w"> </span><span class="nv">l_extent</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">n</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">norm</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">o</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc1&#39;</span>,<span class="w"> </span><span class="nv">pdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">pe_dim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">pe_type</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">players</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">prefix</span><span class="o">=</span><span class="s1">&#39;vol_&#39;</span>,<span class="w"> </span><span class="nv">qdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">qlayers</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">weights</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/weights.49.pkl&#39;</span>,<span class="w"> </span><span class="nv">z</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">z_end</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">z_start</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">zdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">zfile</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc1/z_values.txt&#39;</span><span class="o">)</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:50<span class="w">     </span>Loaded<span class="w"> </span>configuration:
<span class="o">{</span><span class="s1">&#39;dataset_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;ctf&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/ctf.new.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;datadir&#39;</span>:<span class="w"> </span>None,
<span class="w">                  </span><span class="s1">&#39;do_pose_sgd&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;ind&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/aux/ind2.train.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;invert_data&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;keepreal&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;norm&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">325</span>.65057<span class="o">]</span>,
<span class="w">                  </span><span class="s1">&#39;particles&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/256/projections.txt&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;poses&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/pose.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;window&#39;</span>:<span class="w"> </span>False<span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;lattice_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;D&#39;</span>:<span class="w"> </span><span class="m">257</span>,<span class="w"> </span><span class="s1">&#39;extent&#39;</span>:<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="s1">&#39;ignore_DC&#39;</span>:<span class="w"> </span>True<span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;model_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;activation&#39;</span>:<span class="w"> </span><span class="s1">&#39;relu&#39;</span>,
<span class="w">                </span><span class="s1">&#39;domain&#39;</span>:<span class="w"> </span><span class="s1">&#39;fourier&#39;</span>,
<span class="w">                </span><span class="s1">&#39;enc_mask&#39;</span>:<span class="w"> </span><span class="m">128</span>,
<span class="w">                </span><span class="s1">&#39;encode_mode&#39;</span>:<span class="w"> </span><span class="s1">&#39;resid&#39;</span>,
<span class="w">                </span><span class="s1">&#39;pdim&#39;</span>:<span class="w"> </span><span class="m">1024</span>,
<span class="w">                </span><span class="s1">&#39;pe_dim&#39;</span>:<span class="w"> </span>None,
<span class="w">                </span><span class="s1">&#39;pe_type&#39;</span>:<span class="w"> </span><span class="s1">&#39;geom_lowf&#39;</span>,
<span class="w">                </span><span class="s1">&#39;players&#39;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">                </span><span class="s1">&#39;qdim&#39;</span>:<span class="w"> </span><span class="m">1024</span>,
<span class="w">                </span><span class="s1">&#39;qlayers&#39;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">                </span><span class="s1">&#39;zdim&#39;</span>:<span class="w"> </span><span class="m">8</span><span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;seed&#39;</span>:<span class="w"> </span><span class="m">21152</span><span class="o">}</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:56<span class="w">     </span>Using<span class="w"> </span>circular<span class="w"> </span>lattice<span class="w"> </span>with<span class="w"> </span>radius<span class="w"> </span><span class="m">128</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:56<span class="w">     </span>Generating<span class="w"> </span><span class="m">10</span><span class="w"> </span>volumes
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:24:56<span class="w">     </span><span class="o">[</span>-0.13908401<span class="w"> </span>-0.66560406<span class="w">  </span><span class="m">0</span>.95547887<span class="w"> </span>-0.6795193<span class="w">   </span><span class="m">2</span>.33642701<span class="w">  </span><span class="m">2</span>.05639807
<span class="w"> </span>-1.21175412<span class="w"> </span>-2.10233111<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:25:06<span class="w">     </span><span class="o">[</span>-0.13527223<span class="w"> </span>-0.48584066<span class="w">  </span><span class="m">0</span>.75453086<span class="w"> </span>-0.51289588<span class="w">  </span><span class="m">1</span>.81356009<span class="w">  </span><span class="m">1</span>.58481893
<span class="w"> </span>-0.9511668<span class="w">  </span>-1.6463648<span class="w"> </span><span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:25:15<span class="w">     </span><span class="o">[</span>-0.13146044<span class="w"> </span>-0.30607727<span class="w">  </span><span class="m">0</span>.55358285<span class="w"> </span>-0.34627247<span class="w">  </span><span class="m">1</span>.29069317<span class="w">  </span><span class="m">1</span>.11323979
<span class="w"> </span>-0.69057947<span class="w"> </span>-1.19039849<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:25:23<span class="w">     </span><span class="o">[</span>-0.12764866<span class="w"> </span>-0.12631387<span class="w">  </span><span class="m">0</span>.35263484<span class="w"> </span>-0.17964905<span class="w">  </span><span class="m">0</span>.76782624<span class="w">  </span><span class="m">0</span>.64166065
<span class="w"> </span>-0.42999215<span class="w"> </span>-0.73443218<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:25:32<span class="w">     </span><span class="o">[</span>-0.12383687<span class="w">  </span><span class="m">0</span>.05344952<span class="w">  </span><span class="m">0</span>.15168683<span class="w"> </span>-0.01302564<span class="w">  </span><span class="m">0</span>.24495932<span class="w">  </span><span class="m">0</span>.1700815
<span class="w"> </span>-0.16940482<span class="w"> </span>-0.27846588<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:25:41<span class="w">     </span><span class="o">[</span>-0.12002508<span class="w">  </span><span class="m">0</span>.23321291<span class="w"> </span>-0.04926117<span class="w">  </span><span class="m">0</span>.15359777<span class="w"> </span>-0.2779076<span class="w">  </span>-0.30149764
<span class="w">  </span><span class="m">0</span>.09118251<span class="w">  </span><span class="m">0</span>.17750043<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:25:49<span class="w">     </span><span class="o">[</span>-0.1162133<span class="w">   </span><span class="m">0</span>.41297631<span class="w"> </span>-0.25020918<span class="w">  </span><span class="m">0</span>.32022119<span class="w"> </span>-0.80077453<span class="w"> </span>-0.77307678
<span class="w">  </span><span class="m">0</span>.35176983<span class="w">  </span><span class="m">0</span>.63346674<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:25:58<span class="w">     </span><span class="o">[</span>-0.11240151<span class="w">  </span><span class="m">0</span>.5927397<span class="w">  </span>-0.45115719<span class="w">  </span><span class="m">0</span>.4868446<span class="w">  </span>-1.32364145<span class="w"> </span>-1.24465592
<span class="w">  </span><span class="m">0</span>.61235716<span class="w">  </span><span class="m">1</span>.08943305<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:07<span class="w">     </span><span class="o">[</span>-0.10858973<span class="w">  </span><span class="m">0</span>.7725031<span class="w">  </span>-0.6521052<span class="w">   </span><span class="m">0</span>.65346802<span class="w"> </span>-1.84650837<span class="w"> </span>-1.71623506
<span class="w">  </span><span class="m">0</span>.87294448<span class="w">  </span><span class="m">1</span>.54539936<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:15<span class="w">     </span><span class="o">[</span>-0.10477794<span class="w">  </span><span class="m">0</span>.95226649<span class="w"> </span>-0.85305321<span class="w">  </span><span class="m">0</span>.82009143<span class="w"> </span>-2.3693753<span class="w">  </span>-2.1878142
<span class="w">  </span><span class="m">1</span>.13353181<span class="w">  </span><span class="m">2</span>.00136567<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:24<span class="w">     </span>Finsihed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>:01:33.787293
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:25<span class="w">     </span>Running<span class="w"> </span>command:
cryodrgn<span class="w"> </span>eval_vol<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/weights.49.pkl<span class="w"> </span>--config<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/config.yaml<span class="w"> </span>--zfile<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc2/z_values.txt<span class="w"> </span>-o<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc2<span class="w"> </span>--Apix<span class="w"> </span><span class="m">1</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:27<span class="w">     </span>Use<span class="w"> </span>cuda<span class="w"> </span>True
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:27<span class="w">     </span>Namespace<span class="o">(</span><span class="nv">Apix</span><span class="o">=</span><span class="m">1</span>.0,<span class="w"> </span><span class="nv">D</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span>,<span class="w"> </span><span class="nv">config</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/config.yaml&#39;</span>,<span class="w"> </span><span class="nv">domain</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">downsample</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">enc_mask</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">encode_mode</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">flip</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">func</span><span class="o">=</span>&lt;<span class="k">function</span><span class="w"> </span>main<span class="w"> </span>at<span class="w"> </span>0x2000ac580e18&gt;,<span class="w"> </span><span class="nv">l_extent</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">n</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">norm</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">o</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc2&#39;</span>,<span class="w"> </span><span class="nv">pdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">pe_dim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">pe_type</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">players</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">prefix</span><span class="o">=</span><span class="s1">&#39;vol_&#39;</span>,<span class="w"> </span><span class="nv">qdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">qlayers</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">weights</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/weights.49.pkl&#39;</span>,<span class="w"> </span><span class="nv">z</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">z_end</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">z_start</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">zdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">zfile</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/pc2/z_values.txt&#39;</span><span class="o">)</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:27<span class="w">     </span>Loaded<span class="w"> </span>configuration:
<span class="o">{</span><span class="s1">&#39;dataset_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;ctf&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/ctf.new.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;datadir&#39;</span>:<span class="w"> </span>None,
<span class="w">                  </span><span class="s1">&#39;do_pose_sgd&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;ind&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/aux/ind2.train.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;invert_data&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;keepreal&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;norm&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">325</span>.65057<span class="o">]</span>,
<span class="w">                  </span><span class="s1">&#39;particles&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/256/projections.txt&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;poses&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/pose.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;window&#39;</span>:<span class="w"> </span>False<span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;lattice_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;D&#39;</span>:<span class="w"> </span><span class="m">257</span>,<span class="w"> </span><span class="s1">&#39;extent&#39;</span>:<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="s1">&#39;ignore_DC&#39;</span>:<span class="w"> </span>True<span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;model_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;activation&#39;</span>:<span class="w"> </span><span class="s1">&#39;relu&#39;</span>,
<span class="w">                </span><span class="s1">&#39;domain&#39;</span>:<span class="w"> </span><span class="s1">&#39;fourier&#39;</span>,
<span class="w">                </span><span class="s1">&#39;enc_mask&#39;</span>:<span class="w"> </span><span class="m">128</span>,
<span class="w">                </span><span class="s1">&#39;encode_mode&#39;</span>:<span class="w"> </span><span class="s1">&#39;resid&#39;</span>,
<span class="w">                </span><span class="s1">&#39;pdim&#39;</span>:<span class="w"> </span><span class="m">1024</span>,
<span class="w">                </span><span class="s1">&#39;pe_dim&#39;</span>:<span class="w"> </span>None,
<span class="w">                </span><span class="s1">&#39;pe_type&#39;</span>:<span class="w"> </span><span class="s1">&#39;geom_lowf&#39;</span>,
<span class="w">                </span><span class="s1">&#39;players&#39;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">                </span><span class="s1">&#39;qdim&#39;</span>:<span class="w"> </span><span class="m">1024</span>,
<span class="w">                </span><span class="s1">&#39;qlayers&#39;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">                </span><span class="s1">&#39;zdim&#39;</span>:<span class="w"> </span><span class="m">8</span><span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;seed&#39;</span>:<span class="w"> </span><span class="m">21152</span><span class="o">}</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:28<span class="w">     </span>Using<span class="w"> </span>circular<span class="w"> </span>lattice<span class="w"> </span>with<span class="w"> </span>radius<span class="w"> </span><span class="m">128</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:29<span class="w">     </span>Generating<span class="w"> </span><span class="m">10</span><span class="w"> </span>volumes
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:29<span class="w">     </span><span class="o">[</span>-0.23653386<span class="w"> </span>-2.73221812<span class="w">  </span><span class="m">0</span>.08971123<span class="w">  </span><span class="m">0</span>.73753149<span class="w"> </span>-1.50277524<span class="w"> </span>-0.29134391
<span class="w">  </span><span class="m">0</span>.51194909<span class="w"> </span>-1.28563224<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:38<span class="w">     </span><span class="o">[</span>-0.20853919<span class="w"> </span>-2.02861518<span class="w">  </span><span class="m">0</span>.07751347<span class="w">  </span><span class="m">0</span>.57718157<span class="w"> </span>-1.1477155<span class="w">  </span>-0.24292948
<span class="w">  </span><span class="m">0</span>.38124093<span class="w"> </span>-0.97811094<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:46<span class="w">     </span><span class="o">[</span>-0.18054453<span class="w"> </span>-1.32501224<span class="w">  </span><span class="m">0</span>.06531572<span class="w">  </span><span class="m">0</span>.41683164<span class="w"> </span>-0.79265575<span class="w"> </span>-0.19451505
<span class="w">  </span><span class="m">0</span>.25053277<span class="w"> </span>-0.67058963<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:26:55<span class="w">     </span><span class="o">[</span>-0.15254986<span class="w"> </span>-0.6214093<span class="w">   </span><span class="m">0</span>.05311796<span class="w">  </span><span class="m">0</span>.25648172<span class="w"> </span>-0.43759601<span class="w"> </span>-0.14610062
<span class="w">  </span><span class="m">0</span>.11982461<span class="w"> </span>-0.36306833<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:04<span class="w">     </span><span class="o">[</span>-0.12455519<span class="w">  </span><span class="m">0</span>.08219364<span class="w">  </span><span class="m">0</span>.0409202<span class="w">   </span><span class="m">0</span>.09613179<span class="w"> </span>-0.08253627<span class="w"> </span>-0.09768618
<span class="w"> </span>-0.01088355<span class="w"> </span>-0.05554702<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:12<span class="w">     </span><span class="o">[</span>-0.09656052<span class="w">  </span><span class="m">0</span>.78579658<span class="w">  </span><span class="m">0</span>.02872244<span class="w"> </span>-0.06421813<span class="w">  </span><span class="m">0</span>.27252347<span class="w"> </span>-0.04927175
<span class="w"> </span>-0.14159171<span class="w">  </span><span class="m">0</span>.25197428<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:21<span class="w">     </span><span class="o">[</span>-6.85658553e-02<span class="w">  </span><span class="m">1</span>.48939952e+00<span class="w">  </span><span class="m">1</span>.65246763e-02<span class="w"> </span>-2.24568055e-01
<span class="w">  </span><span class="m">6</span>.27583215e-01<span class="w"> </span>-8.57319322e-04<span class="w"> </span>-2.72299871e-01<span class="w">  </span><span class="m">5</span>.59495585e-01<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:30<span class="w">     </span><span class="o">[</span>-0.04057119<span class="w">  </span><span class="m">2</span>.19300245<span class="w">  </span><span class="m">0</span>.00432692<span class="w"> </span>-0.38491798<span class="w">  </span><span class="m">0</span>.98264296<span class="w">  </span><span class="m">0</span>.04755711
<span class="w"> </span>-0.40300803<span class="w">  </span><span class="m">0</span>.86701689<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:38<span class="w">     </span><span class="o">[</span>-0.01257652<span class="w">  </span><span class="m">2</span>.89660539<span class="w"> </span>-0.00787084<span class="w"> </span>-0.5452679<span class="w">   </span><span class="m">1</span>.3377027<span class="w">   </span><span class="m">0</span>.09597154
<span class="w"> </span>-0.53371619<span class="w">  </span><span class="m">1</span>.17453819<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:47<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.01541815<span class="w">  </span><span class="m">3</span>.60020833<span class="w"> </span>-0.0200686<span class="w">  </span>-0.70561783<span class="w">  </span><span class="m">1</span>.69276244<span class="w">  </span><span class="m">0</span>.14438598
<span class="w"> </span>-0.66442435<span class="w">  </span><span class="m">1</span>.4820595<span class="w"> </span><span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:56<span class="w">     </span>Finsihed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>:01:29.431088
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:27:56<span class="w">     </span>K-means<span class="w"> </span>clustering...
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:01<span class="w">     </span>Generating<span class="w"> </span>volumes...
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:01<span class="w">     </span>Running<span class="w"> </span>command:
cryodrgn<span class="w"> </span>eval_vol<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/weights.49.pkl<span class="w"> </span>--config<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/config.yaml<span class="w"> </span>--zfile<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/kmeans20/z_values.txt<span class="w"> </span>-o<span class="w"> </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/kmeans20<span class="w"> </span>--Apix<span class="w"> </span><span class="m">1</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:03<span class="w">     </span>Use<span class="w"> </span>cuda<span class="w"> </span>True
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:03<span class="w">     </span>Namespace<span class="o">(</span><span class="nv">Apix</span><span class="o">=</span><span class="m">1</span>.0,<span class="w"> </span><span class="nv">D</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span>,<span class="w"> </span><span class="nv">config</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/config.yaml&#39;</span>,<span class="w"> </span><span class="nv">domain</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">downsample</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">enc_mask</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">encode_mode</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">flip</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">func</span><span class="o">=</span>&lt;<span class="k">function</span><span class="w"> </span>main<span class="w"> </span>at<span class="w"> </span>0x2000ac580e18&gt;,<span class="w"> </span><span class="nv">l_extent</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">n</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">norm</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">o</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/kmeans20&#39;</span>,<span class="w"> </span><span class="nv">pdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">pe_dim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">pe_type</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">players</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">prefix</span><span class="o">=</span><span class="s1">&#39;vol_&#39;</span>,<span class="w"> </span><span class="nv">qdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">qlayers</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">weights</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/weights.49.pkl&#39;</span>,<span class="w"> </span><span class="nv">z</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">z_end</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">z_start</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">zdim</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">zfile</span><span class="o">=</span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/kmeans20/z_values.txt&#39;</span><span class="o">)</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:03<span class="w">     </span>Loaded<span class="w"> </span>configuration:
<span class="o">{</span><span class="s1">&#39;dataset_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;ctf&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/ctf.new.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;datadir&#39;</span>:<span class="w"> </span>None,
<span class="w">                  </span><span class="s1">&#39;do_pose_sgd&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;ind&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/aux/ind2.train.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;invert_data&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;keepreal&#39;</span>:<span class="w"> </span>False,
<span class="w">                  </span><span class="s1">&#39;norm&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">325</span>.65057<span class="o">]</span>,
<span class="w">                  </span><span class="s1">&#39;particles&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/256/projections.txt&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;poses&#39;</span>:<span class="w"> </span><span class="s1">&#39;/nobackup/users/zhonge/cryodrgn/11_l17_ribo/data/pose.pkl&#39;</span>,
<span class="w">                  </span><span class="s1">&#39;window&#39;</span>:<span class="w"> </span>False<span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;lattice_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;D&#39;</span>:<span class="w"> </span><span class="m">257</span>,<span class="w"> </span><span class="s1">&#39;extent&#39;</span>:<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="s1">&#39;ignore_DC&#39;</span>:<span class="w"> </span>True<span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;model_args&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;activation&#39;</span>:<span class="w"> </span><span class="s1">&#39;relu&#39;</span>,
<span class="w">                </span><span class="s1">&#39;domain&#39;</span>:<span class="w"> </span><span class="s1">&#39;fourier&#39;</span>,
<span class="w">                </span><span class="s1">&#39;enc_mask&#39;</span>:<span class="w"> </span><span class="m">128</span>,
<span class="w">                </span><span class="s1">&#39;encode_mode&#39;</span>:<span class="w"> </span><span class="s1">&#39;resid&#39;</span>,
<span class="w">                </span><span class="s1">&#39;pdim&#39;</span>:<span class="w"> </span><span class="m">1024</span>,
<span class="w">                </span><span class="s1">&#39;pe_dim&#39;</span>:<span class="w"> </span>None,
<span class="w">                </span><span class="s1">&#39;pe_type&#39;</span>:<span class="w"> </span><span class="s1">&#39;geom_lowf&#39;</span>,
<span class="w">                </span><span class="s1">&#39;players&#39;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">                </span><span class="s1">&#39;qdim&#39;</span>:<span class="w"> </span><span class="m">1024</span>,
<span class="w">                </span><span class="s1">&#39;qlayers&#39;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">                </span><span class="s1">&#39;zdim&#39;</span>:<span class="w"> </span><span class="m">8</span><span class="o">}</span>,
<span class="w"> </span><span class="s1">&#39;seed&#39;</span>:<span class="w"> </span><span class="m">21152</span><span class="o">}</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:04<span class="w">     </span>Using<span class="w"> </span>circular<span class="w"> </span>lattice<span class="w"> </span>with<span class="w"> </span>radius<span class="w"> </span><span class="m">128</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:05<span class="w">     </span>Generating<span class="w"> </span><span class="m">20</span><span class="w"> </span>volumes
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:05<span class="w">     </span><span class="o">[</span>-1.45019531<span class="w"> </span>-1.14550781<span class="w">  </span><span class="m">0</span>.06768799<span class="w"> </span>-0.26074219<span class="w"> </span>-1.40332031<span class="w">  </span><span class="m">0</span>.63574219
<span class="w"> </span>-0.65576172<span class="w"> </span>-3.86523438<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:14<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.71191406<span class="w"> </span>-1.34570312<span class="w"> </span>-1.46777344<span class="w">  </span><span class="m">2</span>.5078125<span class="w">   </span><span class="m">0</span>.31176758<span class="w"> </span>-0.37353516
<span class="w"> </span>-1.26367188<span class="w"> </span>-0.44970703<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:22<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.0526123<span class="w">  </span>-3.54492188<span class="w"> </span>-0.11004639<span class="w"> </span>-1.203125<span class="w">    </span><span class="m">1</span>.15429688<span class="w">  </span><span class="m">0</span>.99072266
<span class="w"> </span>-1.21777344<span class="w"> </span>-1.796875<span class="w">  </span><span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:31<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.37890625<span class="w"> </span>-1.99902344<span class="w">  </span><span class="m">1</span>.69921875<span class="w">  </span><span class="m">0</span>.80175781<span class="w"> </span>-0.14501953<span class="w">  </span><span class="m">1</span>.3984375
<span class="w"> </span>-0.59619141<span class="w"> </span>-0.50732422<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:40<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">1</span>.34179688<span class="w"> </span>-0.81445312<span class="w">  </span><span class="m">1</span>.42382812<span class="w">  </span><span class="m">0</span>.95751953<span class="w">  </span><span class="m">1</span>.82324219<span class="w"> </span>-0.29614258
<span class="w">  </span><span class="m">0</span>.68896484<span class="w"> </span>-1.44140625<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:49<span class="w">     </span><span class="o">[</span>-2.7734375<span class="w">   </span><span class="m">0</span>.28222656<span class="w">  </span><span class="m">0</span>.20996094<span class="w">  </span><span class="m">1</span>.68554688<span class="w"> </span>-0.72167969<span class="w"> </span>-1.94433594
<span class="w"> </span>-1.87402344<span class="w">  </span><span class="m">0</span>.43188477<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:28:57<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">2</span>.0234375<span class="w">   </span><span class="m">0</span>.16711426<span class="w">  </span><span class="m">0</span>.40917969<span class="w">  </span><span class="m">1</span>.89941406<span class="w"> </span>-1.24902344<span class="w"> </span>-3.1953125
<span class="w">  </span><span class="m">0</span>.54736328<span class="w">  </span><span class="m">0</span>.80371094<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:29:06<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">1</span>.54495239e-03<span class="w"> </span>-2.34179688e+00<span class="w"> </span>-8.84765625e-01<span class="w"> </span>-1.37207031e+00
<span class="w"> </span>-2.89648438e+00<span class="w"> </span>-7.03125000e-01<span class="w"> </span>-3.58642578e-01<span class="w">  </span><span class="m">4</span>.86145020e-02<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:29:15<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.56298828<span class="w"> </span>-1.85449219<span class="w"> </span>-1.29003906<span class="w">  </span><span class="m">1</span>.12011719<span class="w"> </span>-2.30859375<span class="w"> </span>-1.21777344
<span class="w">  </span><span class="m">1</span>.09960938<span class="w">  </span><span class="m">1</span>.78027344<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:29:23<span class="w">     </span><span class="o">[</span>-1.92382812<span class="w"> </span>-2.53125<span class="w">     </span><span class="m">0</span>.17822266<span class="w">  </span><span class="m">1</span>.21386719<span class="w">  </span><span class="m">0</span>.18640137<span class="w">  </span><span class="m">0</span>.56542969
<span class="w">  </span><span class="m">1</span>.14648438<span class="w">  </span><span class="m">0</span>.16760254<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:29:32<span class="w">     </span><span class="o">[</span>-0.76513672<span class="w"> </span>-0.51318359<span class="w">  </span><span class="m">0</span>.98779297<span class="w">  </span><span class="m">1</span>.11328125<span class="w"> </span>-2.30078125<span class="w"> </span>-0.34350586
<span class="w">  </span><span class="m">2</span>.07226562<span class="w"> </span>-0.29492188<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:29:41<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.08319092<span class="w">  </span><span class="m">2</span>.77148438<span class="w"> </span>-1.41992188<span class="w">  </span><span class="m">0</span>.32055664<span class="w"> </span>-1.33886719<span class="w">  </span><span class="m">0</span>.69873047
<span class="w">  </span><span class="m">0</span>.36987305<span class="w">  </span><span class="m">3</span>.66601562<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:29:49<span class="w">     </span><span class="o">[</span>-1.55566406<span class="w">  </span><span class="m">2</span>.93359375<span class="w">  </span><span class="m">0</span>.62402344<span class="w"> </span>-1.88378906<span class="w"> </span>-0.35253906<span class="w"> </span>-0.8515625
<span class="w">  </span><span class="m">1</span>.06835938<span class="w">  </span><span class="m">2</span>.41015625<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:29:58<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.25854492<span class="w">  </span><span class="m">2</span>.3125<span class="w">     </span>-0.97119141<span class="w"> </span>-1.78320312<span class="w">  </span><span class="m">0</span>.2220459<span class="w">  </span>-3.63476562
<span class="w">  </span><span class="m">0</span>.96826172<span class="w">  </span><span class="m">2</span>.15625<span class="w">   </span><span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:07<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.64306641<span class="w">  </span><span class="m">2</span>.70117188<span class="w"> </span>-0.85791016<span class="w"> </span>-0.04754639<span class="w">  </span><span class="m">2</span>.31054688<span class="w">  </span><span class="m">3</span>.125
<span class="w"> </span>-1.95703125<span class="w">  </span><span class="m">0</span>.05780029<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:15<span class="w">     </span><span class="o">[</span>-0.3605957<span class="w">   </span><span class="m">0</span>.45092773<span class="w">  </span><span class="m">1</span>.70800781<span class="w"> </span>-2.24804688<span class="w">  </span><span class="m">3</span>.0390625<span class="w">   </span><span class="m">1</span>.54492188
<span class="w"> </span>-0.83007812<span class="w"> </span>-0.16125488<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:24<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">1</span>.39355469<span class="w">  </span><span class="m">2</span>.33789062<span class="w">  </span><span class="m">2</span>.18164062<span class="w"> </span>-0.00338936<span class="w">  </span><span class="m">2</span>.87109375<span class="w">  </span><span class="m">0</span>.89550781
<span class="w"> </span>-0.84960938<span class="w">  </span><span class="m">0</span>.14160156<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:33<span class="w">     </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.47851562<span class="w">  </span><span class="m">2</span>.55273438<span class="w"> </span>-0.328125<span class="w">   </span>-0.96533203<span class="w"> </span>-0.6796875<span class="w">   </span><span class="m">1</span>.35449219
<span class="w">  </span><span class="m">1</span>.08007812<span class="w"> </span>-1.60253906<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:41<span class="w">     </span><span class="o">[</span>-0.38061523<span class="w">  </span><span class="m">1</span>.22949219<span class="w"> </span>-1.48046875<span class="w"> </span>-0.50439453<span class="w">  </span><span class="m">2</span>.12890625<span class="w"> </span>-0.9296875
<span class="w"> </span>-0.40283203<span class="w">  </span><span class="m">0</span>.62597656<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:50<span class="w">     </span><span class="o">[</span>-2.12695312<span class="w">  </span><span class="m">2</span>.45507812<span class="w">  </span><span class="m">0</span>.38671875<span class="w">  </span><span class="m">1</span>.51757812<span class="w">  </span><span class="m">0</span>.96386719<span class="w">  </span><span class="m">1</span>.17089844
<span class="w">  </span><span class="m">1</span>.08300781<span class="w">  </span><span class="m">0</span>.84228516<span class="o">]</span>
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:59<span class="w">     </span>Finsihed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>:02:56.162816
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:30:59<span class="w">     </span>Running<span class="w"> </span>UMAP...
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:33:00<span class="w">     </span>Generating<span class="w"> </span>plots...
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:33:13<span class="w">     </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/cryoDRGN_viz.ipynb<span class="w"> </span>already<span class="w"> </span>exists.<span class="w"> </span>Skipping
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:33:13<span class="w">     </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/cryoDRGN_viz.ipynb
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:33:13<span class="w">     </span>Creating<span class="w"> </span>jupyter<span class="w"> </span>notebook...
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:33:14<span class="w">     </span>/nobackup/users/zhonge/cryodrgn/11_l17_ribo/04_vae256_gpu/3_gpu1_b8/analyze.49/cryoDRGN_filtering.ipynb
<span class="m">2021</span>-02-28<span class="w"> </span><span class="m">14</span>:33:14<span class="w">     </span>Finished<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>:08:25.218678
</pre></div>
</div>
</li>
</ul>
<p>As before, this will create a new directory <code class="docutils literal notranslate"><span class="pre">analyze.49</span></code> in the workdir of the cryodrgn job containing UMAP/PCA visualizations of the latent space, 20 sampled density maps at kmeans cluster centers, 10 density maps along PC1 and PC2, and jupyter notebooks for interactive analysis.</p>
<p>Additional usage notes:</p>
<ul class="simple">
<li><p>The output volumes will be 256^3. To generate downsampled volumes (e.g. to take up less disk space), use the argument <code class="docutils literal notranslate"><span class="pre">-d</span></code>.</p></li>
<li><p>More volumes can be generated with <code class="docutils literal notranslate"><span class="pre">--ksample</span> <span class="pre">N</span></code></p></li>
<li><p>More PCs (up to the dimension of the latent variable) can be generated with <code class="docutils literal notranslate"><span class="pre">--pc</span> <span class="pre">N</span></code></p></li>
<li><p>The pixel size and handedness of a <code class="docutils literal notranslate"><span class="pre">.mrc</span></code> file can also be modified later with the scripts <code class="docutils literal notranslate"><span class="pre">add_psize.py</span></code> and <code class="docutils literal notranslate"><span class="pre">flip_hand.py</span></code> in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> subdirectory of the cryodrgn repository.</p></li>
<li><p>The argument <code class="docutils literal notranslate"><span class="pre">--vol-start-index</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>) dictates the starting index of <code class="docutils literal notranslate"><span class="pre">.mrc</span></code> filenames for generated volumes (<code class="docutils literal notranslate"><span class="pre">vol_nnn.mrc</span></code>). You may want to set this to <code class="docutils literal notranslate"><span class="pre">1</span></code> if, for example you are using <code class="docutils literal notranslate"><span class="pre">ChimeraX</span></code> to visualize these maps, which by convention numbers all maps that it opens from <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
</ul>
<section id="id1">
<h4>Visualization of the latent space<a class="headerlink" href="#id1" title="Link to this heading">ÔÉÅ</a></h4>
<p>Because we trained an 8-dimensional latent variable model (<code class="docutils literal notranslate"><span class="pre">‚Äî-zdim</span> <span class="pre">8</span></code>),  PCA (a linear dimensionality reduction technique) and UMAP (a nonlinear dimensionality technique) are used to visualize the distribution of particle latent embeddings.</p>
<p>PCA  scatter plot (left) and density plot (right)</p>
<p><img alt="z_pca.png" src="../_images/Untitled_46.png" /></p>
<p>z_pca.png</p>
<p><img alt="z_pca_hexbin.png" src="../_images/Untitled_47.png" /></p>
<p>z_pca_hexbin.png</p>
<p>UMAP scatter plot (left) and density plot (right)</p>
<p><img alt="umap.png" src="../_images/Untitled_48.png" /></p>
<p>umap.png</p>
<p><img alt="umap_hexbin.png" src="../_images/Untitled_49.png" /></p>
<p>umap_hexbin.png</p>
<p>The layout of the latent space reproduces the original results shown in Fig 5F of Zhong et al up to the trivial inversion of UMAP2 axis.</p>
</section>
<section id="default-sampled-density-maps">
<h4>Default sampled density maps<a class="headerlink" href="#default-sampled-density-maps" title="Link to this heading">ÔÉÅ</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code> uses the k-means clustering algorithm to <em>partition</em> the latent space into regions (by default k=20 regions), and generate a density map from the center of each of these regions. The goal is to provide a tractable number of representative density maps to visually inspect.</p>
<p>Additional usage notes:</p>
<p>The number of partitions can be updated with the argument <code class="docutils literal notranslate"><span class="pre">--ksample</span> <span class="pre">50</span></code> to change the number of density maps to e.g. 50.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># contents of the directory</span>
<span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>tutorial/01_vae256/analyze.49/kmeans20/
centers_ind.txt<span class="w">  </span>umap.png<span class="w">     </span>vol_003.mrc<span class="w">  </span>vol_007.mrc<span class="w">  </span>vol_011.mrc<span class="w">  </span>vol_015.mrc<span class="w">  </span>vol_019.mrc
centers.txt<span class="w">      </span>vol_000.mrc<span class="w">  </span>vol_004.mrc<span class="w">  </span>vol_008.mrc<span class="w">  </span>vol_012.mrc<span class="w">  </span>vol_016.mrc<span class="w">  </span>z_pca_hex.png
labels.pkl<span class="w">       </span>vol_001.mrc<span class="w">  </span>vol_005.mrc<span class="w">  </span>vol_009.mrc<span class="w">  </span>vol_013.mrc<span class="w">  </span>vol_017.mrc<span class="w">  </span>z_pca.png
umap_hex.png<span class="w">     </span>vol_002.mrc<span class="w">  </span>vol_006.mrc<span class="w">  </span>vol_010.mrc<span class="w">  </span>vol_014.mrc<span class="w">  </span>vol_018.mrc<span class="w">  </span>z_values.txt
</pre></div>
</div>
<iframe src="https://widgets.figshare.com/articles/21171025/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<p><img alt="Location of the twenty volumes in the UMAP visualization" src="../_images/Untitled_50.png" />
<em>Location of the twenty volumes in the UMAP visualization</em></p>
</section>
<section id="id2">
<h4>PC trajectories<a class="headerlink" href="#id2" title="Link to this heading">ÔÉÅ</a></h4>
<p>There are two subdirectories in the analysis directory that will contain volumes generated along the first and second principal components (PC) of the latent space. By default, the volumes are generated at equally spaced points between the first and 99th percentile of the distribution projected onto each principal component (e.g. Fig 6c of Zhong et al).</p>
<ul class="simple">
<li><p>Note 1: The PC trajectories can give a sense of the variability in the structure, however, the principal components of cryoDRGN‚Äôs <em>latent space</em> are not principal components of the volumes due to the nonlinear nature of the decoder.</p></li>
<li><p>Note 2: Principal component trajectories can also produce nonphysical ‚Äúmotions‚Äù, e.g. if there is discrete variability in the structure.</p></li>
</ul>
<p>Additional usage notes:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">--pc</span></code> to change the number of PCs that are generated by <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze</span></code></p></li>
<li><p>For more flexibility in usage, see <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">pc_traversal</span></code></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>tutorial/01_vae256/analyze.49/pc1/
umap.png<span class="w">     </span>vol_001.mrc<span class="w">  </span>vol_003.mrc<span class="w">  </span>vol_005.mrc<span class="w">  </span>vol_007.mrc<span class="w">  </span>vol_009.mrc
vol_000.mrc<span class="w">  </span>vol_002.mrc<span class="w">  </span>vol_004.mrc<span class="w">  </span>vol_006.mrc<span class="w">  </span>vol_008.mrc<span class="w">  </span>z_values.txt
<span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>tutorial/01_vae256/analyze.49/pc2/
umap.png<span class="w">     </span>vol_001.mrc<span class="w">  </span>vol_003.mrc<span class="w">  </span>vol_005.mrc<span class="w">  </span>vol_007.mrc<span class="w">  </span>vol_009.mrc
vol_000.mrc<span class="w">  </span>vol_002.mrc<span class="w">  </span>vol_004.mrc<span class="w">  </span>vol_006.mrc<span class="w">  </span>vol_008.mrc<span class="w">  </span>z_values.txt
</pre></div>
</div>
<section id="pc1-volumes">
<h5>PC1 volumes<a class="headerlink" href="#pc1-volumes" title="Link to this heading">ÔÉÅ</a></h5>
<iframe src="https://widgets.figshare.com/articles/21171079/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<p><em>PC1: vol_000.mrc to vol_009.mrc; This shows one of the assembly pathways from Davis et al where the central protuberance is built before the rest of the complex.</em></p>
<p><img alt="UMAP embeddings colored by PC1 value (pc1/umap.png)" src="../_images/Untitled_51.png" />
<em>UMAP embeddings colored by PC1 value (pc1/umap.png)</em></p>
</section>
<section id="pc2-volumes">
<h5>PC2 volumes<a class="headerlink" href="#pc2-volumes" title="Link to this heading">ÔÉÅ</a></h5>
<iframe src="https://widgets.figshare.com/articles/21171088/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<p><em>PC2: vol_000.mrc to vol_009.mrc; This shows another assembly pathway from Davis et al where the base is built before the rest of the complex.</em></p>
<p><img alt="UMAP embeddings colored by PC2 value (pc2/umap.png)" src="../_images/Untitled_52.png" /></p>
<p><em>UMAP embeddings colored by PC2 value</em></p>
<p>The umap.png plots within the pcX subdirectories show the UMAP embedding colored by each particle‚Äôs projected value along PCX. This helps give a sense of the layout of the latent space and how the UMAP embedding (a nonlinear 8D ‚Üí 2D embedding) is related to the PCA projection (a linear projection from 8D ‚Üí 2D).</p>
</section>
</section>
</section>
<section id="the-cryodrgn-jupyter-notebook">
<span id="step8-2"></span><h3>8.2) The cryoDRGN jupyter notebook<a class="headerlink" href="#the-cryodrgn-jupyter-notebook" title="Link to this heading">ÔÉÅ</a></h3>
<p>CryoDRGN provides a jupyter notebook, <code class="docutils literal notranslate"><span class="pre">cryoDRGN_viz.ipynb</span></code>, which contains more visualization tools to facilitate interactive exploration of the trained model.</p>
<section id="starting-the-jupyter-notebook">
<h4>Starting the jupyter notebook<a class="headerlink" href="#starting-the-jupyter-notebook" title="Link to this heading">ÔÉÅ</a></h4>
<p>See Section 6.1.</p>
</section>
<section id="running-the-jupyter-notebook">
<h4>Running the jupyter notebook<a class="headerlink" href="#running-the-jupyter-notebook" title="Link to this heading">ÔÉÅ</a></h4>
<ul>
<li><p>Make sure the epoch number specified in the third cell is set to the correct epoch that we are analyzing. Since we have trained for 50 epochs, it should be 49 here (0-based indexing).</p></li>
<li><p>Then, you can run each cell one by one to see the outputs. Alternatively, you can run the entire notebook in one go with Cell ‚Üí Run All.</p></li>
<li><p>Additional plots in the Jupyter notebook include:</p>
<ul>
<li><p>Plot of the learning curve (i.e. average loss per epoch)</p>
<p><img alt="assets/Untitled_53.png" src="../_images/Untitled_53.png" /></p>
</li>
<li><p>Plot of the pose distribution</p>
<p><img alt="assets/Untitled_54.png" src="../_images/Untitled_54.png" /></p>
<p><img alt="assets/Untitled_55.png" src="../_images/Untitled_55.png" /></p>
<p><img alt="assets/Untitled_56.png" src="../_images/Untitled_56.png" /></p>
</li>
</ul>
</li>
<li><p>In the ‚ÄúInteractive visualization‚Äù section, any per-particle cryoDRGN data are loaded into an interactive widget for visualization.</p></li>
<li><p>Advanced usage: Additional data series may be added to the pandas dataframe and will automatically show up in the widget.</p></li>
</ul>
<p><img alt="Selected the desired x and y axis data series." src="../_images/Untitled_57.png" /></p>
<p>Selected the desired x and y axis data series.</p>
<p><img alt="label: kmeans20 labelstheta/phi/psi: Euler anglestx/ty: Translationsdf1/df2/dfang/phase: defocus parametersindex: particle ordering" src="../_images/Untitled_58.png" /></p>
<p>label: kmeans20 labels
theta/phi/psi: Euler angles
tx/ty: Translations
df1/df2/dfang/phase: defocus parameters
index: particle ordering</p>
<p>As a debugging tool, it is sometimes useful to visualize the latent space colored by pose or CTF parameters. Regions of the latent space are enriched in particular viewing directions or defocus values may be a sign that the latent variable is modeling these imaging variations instead of structural heterogeneity.</p>
<p><img alt="" src="../_images/Untitled_59.png" /></p>
<p><img alt="" src="../_images/Untitled_60.png" /></p>
</section>
<section id="comparing-to-3d-classification-labels">
<h4>Comparing to 3D classification labels<a class="headerlink" href="#comparing-to-3d-classification-labels" title="Link to this heading">ÔÉÅ</a></h4>
<p>(Optional) Add these code blocks in the jupyter notebook after the data loading sectio to plot by 3D classification labels for major states and minor assembly states.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download from https://zenodo.org/record/4355284</span>
<span class="nv">pub_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>utils.load_pkl<span class="o">(</span><span class="s1">&#39;path/to/published_labels.pkl&#39;</span><span class="o">)</span>
<span class="nv">pub_labels_major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>utils.load_pkl<span class="o">(</span><span class="s1">&#39;path/to/published_labels_major.pkl&#39;</span><span class="o">)</span>

<span class="c1"># get labels for filtered particles</span>
<span class="nv">pub_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pub_labels<span class="o">[</span>ind_orig<span class="o">]</span><span class="w"> </span><span class="c1"># ind_orig is loaded in cell 11 of the jupyter notebook</span>
<span class="nv">pub_labels_major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pub_labels_major<span class="o">[</span>ind_orig<span class="o">]</span>
</pre></div>
</div>
<p>Plot major classes</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># get cluster centers for major classes</span>
<span class="nv">major_centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>range<span class="o">(</span><span class="m">5</span><span class="o">)</span>:
<span class="w">    </span><span class="nv">zsub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>z<span class="o">[</span><span class="nv">pub_labels_major</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>i<span class="o">]</span>
<span class="w">    </span>major_centers.append<span class="o">(</span>np.mean<span class="o">(</span>zsub,axis<span class="o">=</span><span class="m">0</span><span class="o">))</span>
<span class="nv">major_centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">(</span>major_centers<span class="o">)</span>
major_centers2,<span class="w"> </span><span class="nv">major_centers_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>analysis.get_nearest_point<span class="o">(</span>z,major_centers<span class="o">)</span>
</pre></div>
</div>
<p>Plot minor classes</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># get cluster centers for minor classes</span>
<span class="nv">minor_centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>range<span class="o">(</span><span class="m">14</span><span class="o">)</span>:
<span class="w">    </span><span class="nv">zsub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>z<span class="o">[</span><span class="nv">pub_labels</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>i<span class="o">]</span>
<span class="w">    </span>minor_centers.append<span class="o">(</span>np.mean<span class="o">(</span>zsub,axis<span class="o">=</span><span class="m">0</span><span class="o">))</span>
<span class="nv">minor_centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">(</span>minor_centers<span class="o">)</span>
minor_centers2,<span class="w"> </span><span class="nv">minor_centers_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>analysis.get_nearest_point<span class="o">(</span>z,minor_centers<span class="o">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>analysis.plot_by_cluster<span class="o">(</span>umap<span class="o">[</span>:,0<span class="o">]</span>,umap<span class="o">[</span>:,1<span class="o">]</span>,5,pub_labels_major,centers_ind<span class="o">=</span>major_centers_i,annotate<span class="o">=</span>True<span class="o">)</span>
</pre></div>
</div>
<p><img alt="" src="../_images/Untitled_61.png" /></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;C0&#39;</span>,<span class="s1">&#39;C1&#39;</span>,
<span class="w">         </span><span class="s1">&#39;C2&#39;</span>,<span class="s1">&#39;C8&#39;</span>,<span class="s1">&#39;green&#39;</span>,
<span class="w">         </span><span class="s1">&#39;C3&#39;</span>,<span class="s1">&#39;orangered&#39;</span>,<span class="s1">&#39;maroon&#39;</span>,<span class="s1">&#39;lightcoral&#39;</span>,
<span class="w">          </span><span class="s1">&#39;C4&#39;</span>,<span class="s1">&#39;slateblue&#39;</span>,<span class="s1">&#39;magenta&#39;</span>,<span class="s1">&#39;blueviolet&#39;</span>,<span class="s1">&#39;plum&#39;</span><span class="o">]</span>

analysis.plot_by_cluster<span class="o">(</span>umap<span class="o">[</span>:,0<span class="o">]</span>,umap<span class="o">[</span>:,1<span class="o">]</span>,14,pub_labels,centers_ind<span class="o">=</span>minor_centers_i,annotate<span class="o">=</span>True,colors<span class="o">=</span>colors<span class="o">)</span>
</pre></div>
</div>
<p><img alt="" src="../_images/Untitled_62.png" /></p>
</section>
<section id="generating-additional-volumes">
<h4>Generating additional volumes<a class="headerlink" href="#generating-additional-volumes" title="Link to this heading">ÔÉÅ</a></h4>
<p>To generate the volumes associated with each of these assembly states, we can use the last section of the jupyter notebook:</p>
<ul class="simple">
<li><p>For the variable <code class="docutils literal notranslate"><span class="pre">vol_ind</span></code>, replace the empty list with the indices corresponding to the assembly state cluster centers:</p></li>
</ul>
<p><img alt="" src="../_images/Untitled_63.png" /></p>
<ul class="simple">
<li><p>The next cell automatically creates a clean output directory, but you can also define your own, e.g. <code class="docutils literal notranslate"><span class="pre">outdir</span> <span class="pre">=</span> <span class="pre">&quot;major_states&quot;</span></code> .</p></li>
<li><p>Then run the final cell to generate volumes at the values of <code class="docutils literal notranslate"><span class="pre">z</span></code> at the indices defined with <code class="docutils literal notranslate"><span class="pre">vol_ind</span></code>. The volumes will be saved in the specified directory. The cell will also return links to directly download the file into your Downloads folder, which is helpful if accessing the jupyter notebook via ssh.</p></li>
</ul>
<p><img alt="" src="../_images/Untitled_64.png" /></p>
</section>
</section>
<section id="extracting-particles-for-traditional-refinement">
<h3>8.3) Extracting particles for traditional refinement<a class="headerlink" href="#extracting-particles-for-traditional-refinement" title="Link to this heading">ÔÉÅ</a></h3>
<p>In <a class="reference external" href="https://www.nature.com/articles/s41592-020-01049-4">Zhong et al</a>, we identified a new assembly state, C4, which was validated with traditional refinement (see Figure 5F). This section shows how to use the interactive lasso tool to select particles from a region of the latent space and save the particles in .star file format.</p>
<section id="interactive-selection">
<h4>Interactive selection<a class="headerlink" href="#interactive-selection" title="Link to this heading">ÔÉÅ</a></h4>
<p>Use the interactive lasso tool to select the small cluster of particles near the class C megacluster. The table below the plot will update with the indices of the selected datapoints.</p>
<p><img alt="" src="../_images/Untitled_65.png" /></p>
<p><img alt="" src="../_images/Untitled_66.png" /></p>
<p>Then, evaluate the next cell to save the selected particles into the variable <code class="docutils literal notranslate"><span class="pre">ind_selected</span></code>. In this example, 1146 particles were selected.</p>
<p>Note: A representative C4 structure from cryoDRGN can be generated with the <strong>Volume Generation</strong> section of the notebook. Give it a try!</p>
<p>Evaluate the next few cells to view the selection in PCA and UMAP space:</p>
<p><img alt="" src="../_images/Untitled_67.png" /></p>
<p>In the next section of the jupyter notebook, there is template code for saving the index selection. Rename the path as <code class="docutils literal notranslate"><span class="pre">ind_selected_classC4.pkl</span></code> and evaluate the cells to save the selection as an index .pkl file.  We will convert it to a .star file in the next step.</p>
<p><img alt="" src="../_images/Untitled_68.png" /></p>
<p><strong>Note:</strong> An index selection saved as a .pkl file can also be generated from clustering tools in the <code class="docutils literal notranslate"><span class="pre">cryoDRGN_filtering.ipnyb</span></code> jupyter notebook. See Section 6.3.</p>
</section>
</section>
<section id="converting-to-a-star-file">
<h3>Converting to a .star file<a class="headerlink" href="#converting-to-a-star-file" title="Link to this heading">ÔÉÅ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">cryodrgn_utils</span> <span class="pre">write_star</span></code> tool can be used to convert the index <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> of selected particles (and the input particles <code class="docutils literal notranslate"><span class="pre">.mrcs</span></code>, and optionally the ctf and/or pose <code class="docutils literal notranslate"><span class="pre">.pkl</span></code>) to <code class="docutils literal notranslate"><span class="pre">.star</span></code> file format:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cryodrgn_utils</span> <span class="pre">write_star</span> <span class="pre">-h</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>cryodrgn_utils<span class="w"> </span>write_star<span class="w"> </span>-h
usage:<span class="w"> </span>cryodrgn_utils<span class="w"> </span>write_star<span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span><span class="o">[</span>--ctf<span class="w"> </span>CTF<span class="o">]</span><span class="w"> </span><span class="o">[</span>--poses<span class="w"> </span>POSES<span class="o">]</span><span class="w"> </span><span class="o">[</span>--ind<span class="w"> </span>IND<span class="o">]</span><span class="w"> </span><span class="o">[</span>--full-path<span class="o">]</span><span class="w"> </span>-o<span class="w"> </span>O<span class="w"> </span>particles

Create<span class="w"> </span>a<span class="w"> </span>Relion<span class="w"> </span><span class="m">3</span>.0<span class="w"> </span>star<span class="w"> </span>file<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>particle<span class="w"> </span>stack<span class="w"> </span>and<span class="w"> </span>ctf<span class="w"> </span>parameters

positional<span class="w"> </span>arguments:
<span class="w">  </span>particles<span class="w">            </span>Input<span class="w"> </span>particles<span class="w"> </span><span class="o">(</span>.mrcs,<span class="w"> </span>.txt<span class="o">)</span>

optional<span class="w"> </span>arguments:
<span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">           </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<span class="w">  </span>--ctf<span class="w"> </span>CTF<span class="w">            </span>Optionally<span class="w"> </span>include<span class="w"> </span>ctf<span class="w"> </span>information<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>.pkl<span class="w"> </span>file
<span class="w">  </span>--poses<span class="w"> </span>POSES<span class="w">        </span>Optionally<span class="w"> </span>include<span class="w"> </span>pose<span class="w"> </span>information<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>.pkl<span class="w"> </span>file
<span class="w">  </span>--ind<span class="w"> </span>IND<span class="w">            </span>Optionally<span class="w"> </span>filter<span class="w"> </span>by<span class="w"> </span>selected<span class="w"> </span>index<span class="w"> </span>array<span class="w"> </span><span class="o">(</span>.pkl<span class="o">)</span>
<span class="w">  </span>--full-path<span class="w">          </span>Write<span class="w"> </span>the<span class="w"> </span>full<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>particles<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>relative<span class="w"> </span>paths<span class="o">)</span>
<span class="w">  </span>-o<span class="w"> </span>O<span class="w">                 </span>Output<span class="w"> </span>.star<span class="w"> </span>file
</pre></div>
</div>
</li>
</ul>
<p>Note: This command will add ctf/pose information from the corresponding .pkl files, if provided. Any additional fields in the input .star file will be preserved as-is.</p>
<p>Example command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryodrgn_utils<span class="w"> </span>write_star<span class="w"> </span>data/128/particles.128.mrcs<span class="w"> </span>data/ctf.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--poses<span class="w"> </span>data/poses.pkl
<span class="w">    </span>--ind<span class="w"> </span>tutorial/01_vae256/ind_selected_classC4.pkl<span class="w">	</span><span class="se">\</span>
<span class="w">    </span>--full-path<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>class_C4.128.star
</pre></div>
</div>
</section>
<section id="re-extracting-particles-from-the-micrograph">
<h3>Re-extracting particles from the micrograph<a class="headerlink" href="#re-extracting-particles-from-the-micrograph" title="Link to this heading">ÔÉÅ</a></h3>
<p>To re-extract particles from the original micrograph (e.g. at full resolution)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryodrgn_utils<span class="w"> </span>write_star<span class="w"> </span>data/128/particles.128.mrcs<span class="w"> </span>data/ctf.pkl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--poses<span class="w"> </span>data/poses.pkl
<span class="w">    </span>--ind<span class="w"> </span>tutorial/01_vae256/ind_selected_classC4.pkl<span class="w">	</span><span class="se">\</span>
<span class="w">    </span>--full-path<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>class_C4.128.star
</pre></div>
</div>
<p>Note to create a filtered</p>
</section>
<section id="generating-trajectories">
<h3>8.4) Generating trajectories<a class="headerlink" href="#generating-trajectories" title="Link to this heading">ÔÉÅ</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">eval_vol</span></code> can be used to generate additional density maps given a list of z values. (See the <a class="reference external" href="https://github.com/zhonge/cryodrgn">Github README</a> for more complete documentation).</p>
<p>In this section, we will use cryoDRGN‚Äôs graph traversal algorithm to find paths through latent space (<code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">graph_traversal</span></code>), and then generate volumes along this path (<code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">eval_vol</span></code>).</p>
<section id="cryodrgn-graph-traversal">
<h4>cryodrgn graph_traversal<a class="headerlink" href="#cryodrgn-graph-traversal" title="Link to this heading">ÔÉÅ</a></h4>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cryodrgn</span> <span class="pre">graph_traversal</span> <span class="pre">-h</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>cryodrgn<span class="w"> </span>graph_traversal<span class="w"> </span>-h
usage:<span class="w"> </span>cryodrgn<span class="w"> </span>graph_traversal<span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span>--anchors<span class="w"> </span>ANCHORS<span class="w"> </span><span class="o">[</span>ANCHORS<span class="w"> </span>...<span class="o">]</span>
<span class="w">                                </span><span class="o">[</span>--max-neighbors<span class="w"> </span>MAX_NEIGHBORS<span class="o">]</span>
<span class="w">                                </span><span class="o">[</span>--avg-neighbors<span class="w"> </span>AVG_NEIGHBORS<span class="o">]</span>
<span class="w">                                </span><span class="o">[</span>--batch-size<span class="w"> </span>BATCH_SIZE<span class="o">]</span>
<span class="w">                                </span><span class="o">[</span>--max-images<span class="w"> </span>MAX_IMAGES<span class="o">]</span><span class="w"> </span>-o<span class="w"> </span>PATH.TXT<span class="w"> </span>--out-z
<span class="w">                                </span>Z.PATH.TXT
<span class="w">                                </span>data

Find<span class="w"> </span>shortest<span class="w"> </span>path<span class="w"> </span>along<span class="w"> </span>nearest<span class="w"> </span>neighbor<span class="w"> </span>graph

positional<span class="w"> </span>arguments:
<span class="w">  </span>data<span class="w">                  </span>Input<span class="w"> </span>z.pkl<span class="w"> </span>embeddings

optional<span class="w"> </span>arguments:
<span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<span class="w">  </span>--anchors<span class="w"> </span>ANCHORS<span class="w"> </span><span class="o">[</span>ANCHORS<span class="w"> </span>...<span class="o">]</span>
<span class="w">                        </span>Index<span class="w"> </span>of<span class="w"> </span>anchor<span class="w"> </span>points
<span class="w">  </span>--max-neighbors<span class="w"> </span>MAX_NEIGHBORS
<span class="w">  </span>--avg-neighbors<span class="w"> </span>AVG_NEIGHBORS
<span class="w">  </span>--batch-size<span class="w"> </span>BATCH_SIZE
<span class="w">  </span>--max-images<span class="w"> </span>MAX_IMAGES
<span class="w">  </span>-o<span class="w"> </span>PATH.TXT<span class="w">           </span>Output<span class="w"> </span>.txt<span class="w"> </span>file<span class="w"> </span><span class="k">for</span><span class="w"> </span>path<span class="w"> </span>indices
<span class="w">  </span>--out-z<span class="w"> </span>Z.PATH.TXT<span class="w">    </span>Output<span class="w"> </span>.txt<span class="w"> </span>file<span class="w"> </span><span class="k">for</span><span class="w"> </span>path<span class="w"> </span>z-values
</pre></div>
</div>
</li>
</ul>
<p>CryoDRGN‚Äôs graph traversal algorithm builds a nearest neighbor graph between all the latent embeddings, and then performs dijkstra‚Äôs algorithm to find the shortest path on the graph between the anchors nodes. The idea is to find a path between the anchors points in latent space while remaining on the data manifold since we don‚Äôt want to generate structures from empty regions of the latent space.</p>
<p>Example usage, where the kmeans cluster centers are used as the anchor points:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>analyze.49<span class="w"> </span><span class="c1"># assuming you&#39;ve already run cryodrgn analyze</span>
$<span class="w"> </span>cryodrgn<span class="w"> </span>graph_traversal<span class="w"> </span>../z.49.pkl<span class="w"> </span>--anchors<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>kmeans20/centers_ind.txt<span class="k">)</span><span class="w"> </span>-o<span class="w"> </span>graph_traversal/path.txt<span class="w"> </span>--out-z<span class="w"> </span>graph_traversal/z.path.txt
</pre></div>
</div>
<p>Note that you could specify arbitrary data points as the anchor points, e.g. you could manually find the indices of desired data points from the jupyter notebook (in the interactive visualization sections) that you want as the endpoints of the trajectory.</p>
<p><code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">graph_traversal</span></code> will produce a text file containing a list of z values (<code class="docutils literal notranslate"><span class="pre">z.path.txt</span></code>). This may be converted to¬†<code class="docutils literal notranslate"><span class="pre">.mrc</span></code>¬†files with¬†<code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">eval_vol</span></code>, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd graph_traversal
$ cryodrgn eval_vol ../../weights.49.pkl -c ../../config.yaml --zfile z.path.txt -o .
</pre></div>
</div>
</section>
<section id="generating-assembly-trajectories">
<h4>Generating assembly trajectories<a class="headerlink" href="#generating-assembly-trajectories" title="Link to this heading">ÔÉÅ</a></h4>
<p>In <a class="reference internal" href="#step8-2"><span class="std std-ref">section 8.2</span></a> above, we identified the representative particles corresponding to each minor assembly state:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Representative indices for minor assembly states, note these indices will vary between different runs</span>
<span class="c1"># A, B, C1, C2, C3, D1, D2, D3, D4, E1, E2, E3, E4, E5</span>
&gt;&gt;<span class="w"> </span>minor_centers_i
array<span class="o">([</span><span class="m">47225</span>,<span class="w"> </span><span class="m">67124</span>,<span class="w"> </span><span class="m">28314</span>,<span class="w"> </span><span class="m">77185</span>,<span class="w">   </span><span class="m">742</span>,<span class="w"> </span><span class="m">19716</span>,<span class="w"> </span><span class="m">21262</span>,<span class="w"> </span><span class="m">13647</span>,<span class="w"> </span><span class="m">34996</span>,
<span class="w">        </span><span class="m">2660</span>,<span class="w"> </span><span class="m">61443</span>,<span class="w"> </span><span class="m">14564</span>,<span class="w"> </span><span class="m">42638</span>,<span class="w"> </span><span class="m">57647</span><span class="o">])</span>
</pre></div>
</div>
<p>To generate a trajectory for assembly pathway B‚ÜíD1‚ÜíD2‚ÜíD3‚ÜíD4‚ÜíE3‚ÜíE5 in Figure 7 of <a class="reference external" href="https://www.cell.com/cell/fulltext/S0092-8674(16)31592-6?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS0092867416315926%3Fshowall%3Dtrue">Davis et al</a>, use the corresponding assembly state indices as the anchor points in <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">graph_traversal</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryodrgn<span class="w"> </span>graph_traversal<span class="w"> </span>../z.49.pkl<span class="w"> </span>--anchors<span class="w"> </span><span class="m">67124</span><span class="w"> </span><span class="m">19716</span><span class="w"> </span><span class="m">21262</span><span class="w"> </span><span class="m">13647</span><span class="w"> </span><span class="m">34996</span><span class="w"> </span><span class="m">14564</span><span class="w"> </span><span class="m">57647</span><span class="w"> </span>-o<span class="w"> </span>assembly_path_A/path.txt<span class="w"> </span>--out-z<span class="w"> </span>assembly_path_A/z.path.txt
</pre></div>
</div>
<p>This will produce a <code class="docutils literal notranslate"><span class="pre">path.txt</span></code> file and a <code class="docutils literal notranslate"><span class="pre">z.path.txt</span></code> file showing the indices of the path and the values of the latent variable along the path. Then use <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">eval_vol</span></code> to generate volumes from the latent space graph traversal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>assembly_path_A
$<span class="w"> </span>cryodrgn<span class="w"> </span>eval_vol<span class="w"> </span>../../weights.49.pkl<span class="w"> </span>-c<span class="w"> </span>../../config.yaml<span class="w"> </span>--zfile<span class="w"> </span>z.path.txt<span class="w"> </span>-o<span class="w"> </span>.
</pre></div>
</div>
<iframe src="https://widgets.figshare.com/articles/21170974/embed?show_title=1" width="568" height="351" allowfullscreen frameborder="0"></iframe>
<p><em>CryoDRGN‚Äôs graph traversal algorithm through LSU assembly states B‚ÜíD1‚ÜíD2‚ÜíD3‚ÜíD4‚ÜíE3‚ÜíE5</em></p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="cryoDRGN Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="landscape_analysis.html" class="btn btn-neutral float-right" title="cryoDRGN Conformational Landscape Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Ellen Zhong.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>