<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cryoDRGN Conformational Landscape Analysis &mdash; CryoDRGN  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="cryoDRGN preprocess for large datasets" href="large_datasets.html" />
    <link rel="prev" title="cryoDRGN EMPIAR-10076 tutorial" href="empiar_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CryoDRGN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">‚ùÑÔ∏èüêâ cryoDRGN Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">cryoDRGN Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="empiar_tutorial.html">cryoDRGN EMPIAR-10076 tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">cryoDRGN Conformational Landscape Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quickstart">1. Quickstart</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#outputs-at-a-glance">Outputs at a glance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assigning-3d-conformational-states-classes">2. Assigning 3D conformational states (‚Äùclasses‚Äù)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#outputs">Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-change-the-number-of-clusters-with-m">Optional: Change the number of clusters with -M:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-change-agglomerative-clustering-linkage-with-linkage">Optional: Change agglomerative clustering linkage with ‚Äîlinkage:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-remove-junk-clusters-volumes">Optional: Remove junk clusters/volumes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#masking-optional">3. Masking (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-conformational-landscapes">4. Visualizing conformational landscapes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-the-full-conformational-landscape">5. Visualizing the full conformational landscape</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="large_datasets.html">cryoDRGN preprocess for large datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="cryodrgn2.html">CryoDRGN2 quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ / Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CryoDRGN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">cryoDRGN Conformational Landscape Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/landscape_analysis.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cryodrgn-conformational-landscape-analysis">
<h1>cryoDRGN Conformational Landscape Analysis<a class="headerlink" href="#cryodrgn-conformational-landscape-analysis" title="Link to this heading">ÔÉÅ</a></h1>
<p>CryoDRGN is a machine learning system for heterogenous cryo-EM reconstruction. In cryoDRGN‚Äôs framework of <em>generative modeling</em>, once a model is trained, an arbitrary number of volumes may be reconstructed, thus tools are needed to comprehensively explore the reconstructed distribution. This page describes a new ‚Äúlandscape analysis‚Äù tool for comprehensive and quantitative analysis of a trained cryodrgn model, including <strong>1) assigning discrete conformational states (and providing their particle lists for refinement)</strong> and <strong>2) visualizing continuous conformational landscapes</strong>. This tool also allows the user to focus their analysis on specific regions of interest by providing custom masks.</p>
<p>Landscape analysis is implemented in the executables, <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze_landscape</span></code> and <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze_landscape_full</span></code>  available in version 1.0+ of the cryoDRGN <a class="reference external" href="https://github.com/zhonge/cryodrgn">software</a>. The analysis pipeline is fully automated, though there are many command line arguments that can be experimented with, and we provide a jupyter notebook for interactive visualization.</p>
<p>A description of the method is found in <a class="reference external" href="https://www.cs.princeton.edu/~zhonge/papers/zhong-phd-csb-2022.pdf">Chapter 6 of Ellen Zhong‚Äôs thesis</a>.</p>
<p><img alt="Overview of the cryodrgn landscape analysis pipeline." src="../_images/landscape_analysis_overview.png" /></p>
<p><em>Overview of the <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze_landscape</span></code> pipeline. We show the general schematic (top) and its application to a dataset of the ClpXP protease from <a class="reference external" href="https://elifesciences.org/articles/61496">Fei et al. 2020</a> (bottom).</em></p>
<section id="quickstart">
<h2>1. Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading">ÔÉÅ</a></h2>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn analyze_landscape [workdir] [epoch]

# for example:
(cryodrgn) $ cryodrgn analyze_landscape /path/to/cryodrgn/output/directory 24 # assuming 25 epochs of training (0-indexed)

# Use the flag -h to see all settings and their defaults:
(cryodrgn) $ cryodrgn analyze_landscape -h
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">(cryodrgn)</span> <span class="pre">$</span> <span class="pre">cryodrgn</span> <span class="pre">analyze_landscape</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodrgn) $ cryodrgn analyze_landscape -h
usage: analyze_landscape.py [-h] [--device DEVICE] [-o OUTDIR] [--skip-vol]
                            [--skip-umap] [--vol-ind VOL_IND]
                            [--linkage LINKAGE] [-M M] [--pc-dim PC_DIM]
                            [--plot-dim PLOT_DIM] [--Apix APIX] [--flip]
                            [-d DOWNSAMPLE] [--ksample KSAMPLE]
                            [--thresh THRESH] [--dilate DILATE]
                            workdir epoch

Pipeline to analyze cryoDRGN volume distribution

positional arguments:
workdir               Directory with cryoDRGN results
epoch                 Epoch number N to analyze (0-based indexing, corresponding to z.N.pkl, weights.N.pkl)

optional arguments:
-h, --help            show this help message and exit
--device DEVICE       Optionally specify CUDA device
-o OUTDIR, --outdir OUTDIR
                      Output directory for landscape analysis results (default: [workdir]/landscape.[epoch])
--skip-umap           Skip running UMAP
--vol-ind VOL_IND     Index .pkl for filtering volumes

Extra arguments for volume generation:
-N SKETCH_SIZE, --sketch-size SKETCH_SIZE
                      Number of volumes to generate for analysis (default: 1000)
--Apix APIX           Pixel size to add to .mrc header (default: 1 A/pix)
--flip                Flip handedness of output volume
-d DOWNSAMPLE, --downsample DOWNSAMPLE
                      Downsample volumes to this box size (pixels) (default: 128)
--skip-vol            Skip generation of volumes
--vol-start-index VOL_START_INDEX
                      Default value of start index for volume generation (default: 0)

Extra arguments for mask generation:
--thresh THRESH       Density value to threshold for masking (default: half of max density value)
--dilate DILATE       Dilate initial mask by this amount (default: 5 pixels)
--mask MRC            Path to a custom mask. Must be same box size as generated volumes.

Extra arguments for clustering:
--linkage LINKAGE     Linkage for agglomerative clustering (e.g. average, ward) (default: average)
-M M                  Number of clusters (default: 10)

Extra arguments for landscape visualization:
--pc-dim PC_DIM       PCA dimensionality reduction (default: 20)
--plot-dim PLOT_DIM   Number of dimensions to plot (default: 5)
</pre></div>
</div>
</li>
</ul>
<p>By default, the script will:</p>
<ol class="arabic simple">
<li><p><strong>Generate 1000 volumes</strong> at a box size of 128^3</p></li>
<li><p><strong>Perform PCA</strong>  on the volumes to map conformational coordinates. The goal is for the volume PCA coordinates to provide a more visually interpretable representation of the dataset than the VAE latent space.</p></li>
<li><p><strong>Cluster the volumes</strong> and provide summary volumes and the constituent particles for each cluster.</p></li>
</ol>
<p>By default, all outputs will be located in a subdirectory <code class="docutils literal notranslate"><span class="pre">[workdir]/landscape.[epoch]</span></code>.</p>
<p>The expected runtime is ~30 min (1 GPU) which is mostly spent on volume generation); Rerunning the tool without volume generation (<code class="docutils literal notranslate"><span class="pre">--skip-vol</span></code>) should take less than 5 min (no GPU)</p>
<section id="outputs-at-a-glance">
<h3>Outputs at a glance<a class="headerlink" href="#outputs-at-a-glance" title="Link to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">kmeans1000</span></code>: 1000 generated volumes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clustering_L2_average_10</span></code>: clustering of the sketched volume ensemble as summary conformational states with:</p>
<ul>
<li><p>The mean and std volume for each cluster</p></li>
<li><p>The constituent particles for each cluster (.pkl), which can be converted to a .star file</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pcs</span></code>: 5 eigenvolume trajectories of the sketched volume ensemble as summary reaction coordinates</p></li>
</ul>
</section>
</section>
<section id="assigning-3d-conformational-states-classes">
<h2>2. Assigning 3D conformational states (‚Äùclasses‚Äù)<a class="headerlink" href="#assigning-3d-conformational-states-classes" title="Link to this heading">ÔÉÅ</a></h2>
<p>Once 1000 volumes are generated, they are clustered to summarize the major conformational states of the reconstructed ensemble. This clustering approach mirrors some of the assumptions in 3D classification (i.e. that particles fall in 1 of K discrete classes). The resulting clusters can be interpreted as the main conformational states, and this tool provided the constituent particles as a .star file can be exported to other tools for further refinement.</p>
<p>We use agglomerative clustering, a bottom-up clustering algorithm that does not impose any geometric priors on the shape or size of the clusters. Through testing on several datasets, we find that this is effective at <strong>identifying rare states.</strong> We also use a <strong>mask</strong> around the particle to reduce the effect of noise in the background of the density map. A mask may also be manually provided to focus on a specific region (see Section 3).</p>
<p>There are many hyperparameters of the clustering algorithm. As a best practice, one should experiment with the number of clusters (<code class="docutils literal notranslate"><span class="pre">-M</span></code>) and the agglomerative clustering affinity type (e.g. <code class="docutils literal notranslate"><span class="pre">--linkage</span> <span class="pre">average</span></code> or <code class="docutils literal notranslate"><span class="pre">--linkage</span> <span class="pre">ward</span></code>).  See the below subsections for some examples of changing these parameters.</p>
<section id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Link to this heading">ÔÉÅ</a></h3>
<p>The outputs of clustering will be located in a subdirectory <code class="docutils literal notranslate"><span class="pre">clustering_L2_average_10</span></code></p>
<ul class="simple">
<li><p>Each cluster is described by:</p>
<ul>
<li><p>A mean volume and standard deviation volume, e.g. 0_mean.mrc, 0_std.mrc, 1_mean.mrc, 1_std.mrc, ‚Ä¶</p></li>
<li><p>A numbered subdirectory (<code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, etc.) containing the volumes in each cluster</p></li>
<li><p>A list of the underlying particles (as an index <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> file) that may be converted to a .star file with <code class="docutils literal notranslate"><span class="pre">cryodrgn_utils</span> <span class="pre">write_star</span></code></p></li>
</ul>
</li>
<li><p>Visualization of the 1000 volumes colored by cluster label in the VAE latent space (umap.png, umap_annotated.png) and in the volume PCA space (vol_embeddings_1000*png).</p></li>
<li><p>Volume and particle counts for each cluster (volume_counts.png, particle_counts.png)</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>clustering_L2_average_10/
<span class="m">0</span><span class="w">                   </span>2_std.mrc<span class="w">           </span>5_particle_ind.pkl<span class="w">  </span>8_mean.mrc<span class="w">           </span>vol_embeddings_1000_annotated_1_2.png
0_mean.mrc<span class="w">          </span><span class="m">3</span><span class="w">                   </span>5_std.mrc<span class="w">           </span>8_particle_ind.pkl<span class="w">   </span>vol_embeddings_1000_annotated_2_3.png
0_particle_ind.pkl<span class="w">  </span>3_mean.mrc<span class="w">          </span><span class="m">6</span><span class="w">                   </span>8_std.mrc<span class="w">            </span>vol_embeddings_1000_annotated_3_4.png
0_std.mrc<span class="w">           </span>3_particle_ind.pkl<span class="w">  </span>6_mean.mrc<span class="w">          </span><span class="m">9</span><span class="w">                    </span>vol_embeddings_1000_annotated_4_5.png
<span class="m">1</span><span class="w">                   </span>3_std.mrc<span class="w">           </span>6_particle_ind.pkl<span class="w">  </span>9_mean.mrc<span class="w">           </span>vol_embeddings_1000_clusters_1_2.png
1_mean.mrc<span class="w">          </span><span class="m">4</span><span class="w">                   </span>6_std.mrc<span class="w">           </span>9_particle_ind.pkl<span class="w">   </span>vol_embeddings_1000_clusters_2_3.png
1_particle_ind.pkl<span class="w">  </span>4_mean.mrc<span class="w">          </span><span class="m">7</span><span class="w">                   </span>9_std.mrc<span class="w">            </span>vol_embeddings_1000_clusters_3_4.png
1_std.mrc<span class="w">           </span>4_particle_ind.pkl<span class="w">  </span>7_mean.mrc<span class="w">          </span>state_labels.pkl<span class="w">     </span>vol_embeddings_1000_clusters_4_5.png
<span class="m">2</span><span class="w">                   </span>4_std.mrc<span class="w">           </span>7_particle_ind.pkl<span class="w">  </span>particle_counts.png<span class="w">  </span>volume_counts.png
2_mean.mrc<span class="w">          </span><span class="m">5</span><span class="w">                   </span>7_std.mrc<span class="w">           </span>umap_annotated.png
2_particle_ind.pkl<span class="w">  </span>5_mean.mrc<span class="w">          </span><span class="m">8</span><span class="w">                   </span>umap.png
</pre></div>
</div>
</section>
<section id="optional-change-the-number-of-clusters-with-m">
<h3>Optional: Change the number of clusters with -M:<a class="headerlink" href="#optional-change-the-number-of-clusters-with-m" title="Link to this heading">ÔÉÅ</a></h3>
<p>The default number of clusters is 10. If your dataset is very heterogeneous or if you want a finer resolution, you can increase the number of clusters with the <code class="docutils literal notranslate"><span class="pre">-M</span></code> flag. Changing <code class="docutils literal notranslate"><span class="pre">M</span></code> corresponds to changing the cut point in the dendrogram of agglomerative clustering. Clustering can be repeated by re-running <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze_landscape</span></code> and using the <code class="docutils literal notranslate"><span class="pre">--skip-vol</span></code> flag to skip volume generation, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodgn) $ cryodrgn analyze_landscape [workdir] [epoch] --skip-vol -M 20 # use --skip-vol to skip regenerating 1000 volumes

# Results will be found in a new subdirectory, clustering_L2_average_[M]
</pre></div>
</div>
<p><img alt="Left: Clustering results with M=10; Right: Clustering results with M=20" src="../_images/landscape_analysis_clustering_results1.png" /></p>
<p><em>Left: Clustering results with M=10; Right: Clustering results with M=20</em></p>
<p>The updated clustering results will be a new subdirectory, <code class="docutils literal notranslate"><span class="pre">clustering_L2_average_[M]</span></code>.</p>
</section>
<section id="optional-change-agglomerative-clustering-linkage-with-linkage">
<h3>Optional: Change agglomerative clustering linkage with ‚Äîlinkage:<a class="headerlink" href="#optional-change-agglomerative-clustering-linkage-with-linkage" title="Link to this heading">ÔÉÅ</a></h3>
<p>The linkage type affects how volumes are merged in the agglomerative clustering algorithm. The default setting is <code class="docutils literal notranslate"><span class="pre">--linkage</span> <span class="pre">average</span></code>, which, we have found to be sensitive to outliers (e.g. junk/artifacts or rare states of interest). For more evenly populated clusters (e.g. discretizing a structural continuum), try <code class="docutils literal notranslate"><span class="pre">--linkage</span> <span class="pre">ward</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(cryodgn) $ cryodrgn analyze_landscape [workdir] [epoch] --skip-vol --linkage ward # use --skip-vol to skip regenerating 1000 volumes
</pre></div>
</div>
<p><img alt="Left: Clustering results with average linkage (M=10); Right: Clustering results with ward linkage (M=10)" src="../_images/landscape_analysis_clustering_results2.png" /></p>
<p>Left: Clustering results with average linkage (M=10); Right: Clustering results with ward linkage (M=10)</p>
<p>Rerunning landscape analysis with <code class="docutils literal notranslate"><span class="pre">--linkage</span> <span class="pre">ward</span></code> will produce a new subdirectory, <code class="docutils literal notranslate"><span class="pre">clustering_L2_ward_10</span></code>.</p>
</section>
<section id="optional-remove-junk-clusters-volumes">
<h3>Optional: Remove junk clusters/volumes<a class="headerlink" href="#optional-remove-junk-clusters-volumes" title="Link to this heading">ÔÉÅ</a></h3>
<p>Some datasets will contain ‚Äújunk‚Äù volumes that can interfere with clustering/PCA analysis. These volumes can be selected and removed with the utility <code class="docutils literal notranslate"><span class="pre">cryodrgn_utils</span> <span class="pre">select_clusters</span></code>:</p>
<p><img alt="Left: Clustering results with default settings." src="../_images/landscape_analysis_clustering_results3.png" /></p>
<p><em>Left: Clustering results with default settings. Manual inspection of the cluster means revealed broken/junk volumes for clusters 3,5,6,7,8. Right: Repeating cryodrgn analyze_landscape after removing the 9 junk volumes from the analysis.</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># e.g. keep the volumes from clusters 0, 1, 2, 4, 9
(cryodrgn) $ cryodrgn_utils select_clusters clustering_L2_average_10/state_labels.pkl --sel 0 1 2 4 9 -o vol_keep.pkl

# rerun cryodrgn analyze_landscape with --vol-ind
(cryodrgn) $ cryodrgn analyze_landscape [workdir] [epoch] --skip-vol --vol-ind vol_keep.pkl
</pre></div>
</div>
<p>Note: rerunning with <code class="docutils literal notranslate"><span class="pre">‚Äî-vol-ind</span></code> will change the volume PCA results since volumes have now been removed from the analysis.</p>
</section>
</section>
<section id="masking-optional">
<h2>3. Masking (optional)<a class="headerlink" href="#masking-optional" title="Link to this heading">ÔÉÅ</a></h2>
<p>This tool applies a mask on all 1000 volumes before PCA/clustering analysis. The default mask is generated by thresholding all 1000 generated volumes at half of their max density values and then combining all masks (by their union). The masking settings may be adjusted with the <code class="docutils literal notranslate"><span class="pre">--thresh</span></code> and <code class="docutils literal notranslate"><span class="pre">--dilate</span></code> arguments if this automated mask generation leaves in undesired regions (e.g. extra background) or leaves out heterogeneous regions of the particle. To check the mask, see the <code class="docutils literal notranslate"><span class="pre">mask.mrc</span></code> and <code class="docutils literal notranslate"><span class="pre">mask_slices.png</span></code> file in the output directory.</p>
<p><img alt="A user-defined mask around the heterogeneous region of the complex" src="../_images/landscape_analysis_user_defined_mask.png" /></p>
<p><em>A user-defined mask around the heterogeneous region of the complex</em></p>
<p>Alternatively, a custom mask can be provided with the flag <code class="docutils literal notranslate"><span class="pre">--mask</span></code>. Note, the mask will be converted to a <em>binary mask</em>, where any nonzero voxel will be included in the analysis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># rerun cryodrgn analyze_landscape with custom mask
(cryodrgn) $ cryodrgn analyze_lanscape [workdir] [epoch] --skip-vol --mask /path/to/your/mask/eg/job008.mrc
</pre></div>
</div>
</section>
<section id="visualizing-conformational-landscapes">
<h2>4. Visualizing conformational landscapes<a class="headerlink" href="#visualizing-conformational-landscapes" title="Link to this heading">ÔÉÅ</a></h2>
<p>Taking inspiration from <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0092867418300473">previous work</a>, we apply principal component analysis (PCA) on the set of cryoDRGN volumes to map reaction coordinates and visualize a conformational landscape that is more interpretable than the cryoDRGN latent variable representation.</p>
<hr class="docutils" />
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Link to this heading">ÔÉÅ</a></h3>
<p>The output of <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze_landscape</span></code> will include a directory containing the top 5 principal components (.mrc trajectories showing interpolations along the ‚Äúeigenvolumes‚Äù). These principal component trajectories can be interpreted as reaction coordinates for describing the full ensemble, which can provide a more interpretable visualization of the dataset than the latent variable representation.</p>
<p><img alt="Left: Visualization of the dataset in the cryoDRGN VAE latent space" src="../_images/landscape_analysis_latent_space.png" /></p>
<p><em>Left: Visualization of the dataset in the cryoDRGN VAE latent space, colored points correspond to 1000 sampled volumes colored by their cluster label. Center/right: Visualization of 1000 sampled volumes in their PCA feature space. In this example, PC1, PC2, and PC3 correspond to biologically relevant motions and thus the overall organization of the ensemble is more easily interpretable.</em></p>
</section>
</section>
<section id="visualizing-the-full-conformational-landscape">
<h2>5. Visualizing the full conformational landscape<a class="headerlink" href="#visualizing-the-full-conformational-landscape" title="Link to this heading">ÔÉÅ</a></h2>
<p>The initial mapping of the volumes is performed on the set of 1000 sketched volumes. A second tool, <code class="docutils literal notranslate"><span class="pre">cryodrgn</span> <span class="pre">analyze_landscape_full</span></code>, maps all particles to the volume PCA space to visualize a conformational landscape for the full dataset.  This tool will take longer to run (~4 hours on 1 GPU for volume generation, 1 min for mapping).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>cryodrgn<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>cryodrgn<span class="w"> </span>analyze_landscape_full<span class="w"> </span><span class="o">[</span>workdir<span class="o">]</span><span class="w"> </span><span class="o">[</span>epoch<span class="o">]</span><span class="w"> </span>&gt;<span class="w"> </span>landscape_full.log
</pre></div>
</div>
<p><img alt="Left: Visualization of the 1000 volumes in the volume PCA feature space where each volume is a point." src="../_images/landscape_analysis_feature_space.png" /></p>
<p>Left: Visualization of the 1000 volumes in the volume PCA feature space where each volume is a point. Center: Mapping the entire dataset of ~10^5 volumes to the PCA feature space (grey points). Right: Visualizing the conformational landscape as a heatmap on a logscale (i.e. a free energy landscape)</p>
<p>This command produces a jupyter notebook, <code class="docutils literal notranslate"><span class="pre">cryoDRGN_landscape_viz.ipynb</span></code>, for plotting the inferred conformational landscape.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="empiar_tutorial.html" class="btn btn-neutral float-left" title="cryoDRGN EMPIAR-10076 tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="large_datasets.html" class="btn btn-neutral float-right" title="cryoDRGN preprocess for large datasets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Ellen Zhong.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>